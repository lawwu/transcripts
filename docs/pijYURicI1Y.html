<html><head><title>Building efficient hybrid context query for LLM grounding: Simrat Hanspal</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        color: #333;
    }
    .container {
        width: 95%;  /* Increased width to use more space */
        margin: auto;
        overflow: auto;  /* Added to handle overflow by adding a scrollbar if necessary */
    }
    h2, h3 {
        color: #333;
        text-align: center;
    }
    a {
        color: #0000FF;  /* Traditional blue color for links */
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    img {
        display: block;
        margin: auto;
        max-width: 100%;
    }
    .c {
        margin: 10px 0;
    }
    .s, .t {
        display: inline-block;
        margin-right: 5px;
    }
    .max-width {
        max-width: 800px;
        margin: auto;
        padding-left: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;  /* Ensure text alignment is consistent */
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tr:nth-child(odd) {
        background-color: #e6e6e6;
    }
</style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-69VLBMTTP0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-69VLBMTTP0');
    </script>
    </head><body><div class='container'><a href="index.html">back to index</a><h2>Building efficient hybrid context query for LLM grounding: Simrat Hanspal</h2><a href="https://www.youtube.com/watch?v=pijYURicI1Y"><img src="https://i.ytimg.com/vi/pijYURicI1Y/maxresdefault.jpg" style="width:50%;"></a><div><br></div><div style="text-align: left;"><a href="./pijYURicI1Y.html">Whisper Transcript</a> | <a href="./transcript_pijYURicI1Y.html">Transcript Only Page</a></div><br><div style="max-width: 800px;"><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=0" target="_blank">00:00:00.000</a></span> | <span class="t">Hey hey hey, how's everyone? This is Simrit Hanspal, Technical Evangelist at Hasura and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=23" target="_blank">00:00:23.760</a></span> | <span class="t">today I'm going to talk to you about building efficient hybrid drag queries. Let us understand</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=30" target="_blank">00:00:30.640</a></span> | <span class="t">this with the use case of product search in e-commerce domain. Present day, product search</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=36" target="_blank">00:00:36.500</a></span> | <span class="t">is mostly keyword based. Keywords are not great at capturing the complete intent of the user's</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=41" target="_blank">00:00:41.840</a></span> | <span class="t">search query. So you want to move to using natural language. But product search can be</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=46" target="_blank">00:00:46.380</a></span> | <span class="t">either contextual where you're looking for, where you're searching for product based on</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=50" target="_blank">00:00:50.600</a></span> | <span class="t">the descriptive nature or it can be completely structured where you're querying based on</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=55" target="_blank">00:00:55.480</a></span> | <span class="t">the structured fields or it can be both. Large language models are great but they're frozen</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=61" target="_blank">00:01:01.280</a></span> | <span class="t">in time and they cannot solve tasks on data they have not seen before. One of the ways</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=66" target="_blank">00:01:06.720</a></span> | <span class="t">to expose the unseen data to large language model is by providing context to the question</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=71" target="_blank">00:01:11.840</a></span> | <span class="t">alongside the question. This helps the large language model generate more accurate and grounded</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=77" target="_blank">00:01:17.300</a></span> | <span class="t">answers. This powerful technique is called Retrieval Augmented Generation or RAG in short. So you</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=84" target="_blank">00:01:24.180</a></span> | <span class="t">see, we need to build a RAG pipeline for our product search use case. We also need to make</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=89" target="_blank">00:01:29.220</a></span> | <span class="t">sure that our RAG pipeline is production ready and will not leak any sensitive data even if prompted.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=95" target="_blank">00:01:35.220</a></span> | <span class="t">This security concern has been one of the primary concerns of enterprises when building Gen AI applications.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=105" target="_blank">00:01:45.060</a></span> | <span class="t">Data driven applications have been around for a while. Then why are we talking about secure</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=109" target="_blank">00:01:49.940</a></span> | <span class="t">data retrieval all over again for Gen AI applications? Well, this is because we are</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=115" target="_blank">00:01:55.620</a></span> | <span class="t">seeing a paradigm shift in application development. With data driven applications, data is mostly</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=122" target="_blank">00:02:02.580</a></span> | <span class="t">constant and it is the application or the software that evolves for any different or new functionality.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=129" target="_blank">00:02:09.060</a></span> | <span class="t">For example, product search on current e-commerce websites would pick constant data fields only the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=135" target="_blank">00:02:15.540</a></span> | <span class="t">records or the results would change. While in context context driven or RAG application, the data is no</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=146" target="_blank">00:02:26.020</a></span> | <span class="t">longer a constant data packet and it needs to adapt to the dynamic needs of the user's natural language query.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=152" target="_blank">00:02:32.820</a></span> | <span class="t">With natural language query, there is no structural limitations and it can and it gives a scope for</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=160" target="_blank">00:02:40.420</a></span> | <span class="t">malicious attack. Good news, Hasura enables you to build secure data API over your multiple different</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=168" target="_blank">00:02:48.100</a></span> | <span class="t">data sources in no time. Hasura APIs are GraphQL APIs and hence they are dynamic in nature. So you get unified,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=177" target="_blank">00:02:57.140</a></span> | <span class="t">dynamic, secure data API in no time. Just what we needed. So let's get started with building a RAG pipeline for</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=185" target="_blank">00:03:05.060</a></span> | <span class="t">our product search use case.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=188" target="_blank">00:03:08.180</a></span> | <span class="t">Let us again look at what are the different queries that we can expect for our RAG applications. We can</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=195" target="_blank">00:03:15.460</a></span> | <span class="t">have semantic search where we are searching based on semantic similarity with product description from</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=201" target="_blank">00:03:21.540</a></span> | <span class="t">product vector DB. We can also have structured search where we are searching based on structured fields</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=209" target="_blank">00:03:29.140</a></span> | <span class="t">fields in the relation database like for example price and category in Postgres and this requires converting</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=217" target="_blank">00:03:37.300</a></span> | <span class="t">the natural language query into a structured query like SQL or GraphQL. Then we can also have hybrid queries.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=225" target="_blank">00:03:45.060</a></span> | <span class="t">These searches have the elements of both semantic and structured queries. With Hasura,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=230" target="_blank">00:03:50.100</a></span> | <span class="t">we don't need to build separate data APIs for each of them. We can build a unified data API for all three of them.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=236" target="_blank">00:03:56.420</a></span> | <span class="t">So let's get started. We start by connecting our multiple different data sources with Hasura and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=244" target="_blank">00:04:04.340</a></span> | <span class="t">then we query it using a single GraphQL API. I've also built a streamlet application which takes in the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=251" target="_blank">00:04:11.380</a></span> | <span class="t">user input, calls the large language model, generates a GraphQL API query which then gets executed on Hasura.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=260" target="_blank">00:04:20.100</a></span> | <span class="t">So let's head over to Hasura console to get a feel of what it looks like. To start,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=266" target="_blank">00:04:26.660</a></span> | <span class="t">we'll go to the data tab to connect all of our different data sources. I'm not going to do that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=272" target="_blank">00:04:32.420</a></span> | <span class="t">because I have my product Postgres table and product vector table already integrated. As I mentioned before,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=280" target="_blank">00:04:40.740</a></span> | <span class="t">you can use Hasura to query both your relational and vector DB and multiple data sources using</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=288" target="_blank">00:04:48.260</a></span> | <span class="t">a single GraphQL API. But for the sake of simplicity of this demo, I'm going to be using only the vector</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=294" target="_blank">00:04:54.340</a></span> | <span class="t">DB. So I'm using VV8 in this case where I have my vectors and I have also got my price and category</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=303" target="_blank">00:05:03.620</a></span> | <span class="t">structured fields here. One thing to note here is that I have used Hasura's event to auto vectorize</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=310" target="_blank">00:05:10.260</a></span> | <span class="t">my records into my vector DB, which means as and when a new record got inserted into my Postgres table,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=317" target="_blank">00:05:17.620</a></span> | <span class="t">it got auto vectorized and saved in my vector DB. Amazing, I know. So let's go back to our API tab.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=327" target="_blank">00:05:27.060</a></span> | <span class="t">This is where you can play around, execute different queries and see the results.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=332" target="_blank">00:05:32.340</a></span> | <span class="t">Nice. Now that we have gotten a fairly decent sense of what Hasura console is like,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=341" target="_blank">00:05:41.860</a></span> | <span class="t">we can move to the Streamlit app that I have created. As you can see, there are a few configurations</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=348" target="_blank">00:05:48.980</a></span> | <span class="t">on the left hand side panel. So you have Hasura's endpoint and admin secret. This is required to connect</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=354" target="_blank">00:05:54.500</a></span> | <span class="t">with Hasura securely. And then I also have OpenAI's API key. This is required for the chat completion API</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=362" target="_blank">00:06:02.900</a></span> | <span class="t">that I'm using. So let's begin. Let's begin with querying the three different contexts that we were</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=372" target="_blank">00:06:12.260</a></span> | <span class="t">talking about that we want to fetch. So let's start with purely semantic one. Let's look at the different</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=377" target="_blank">00:06:17.940</a></span> | <span class="t">product descriptions that we have and pick something. Let us pick products on essential oils. So let me say,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=386" target="_blank">00:06:26.740</a></span> | <span class="t">show me essential oils for relaxation.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=401" target="_blank">00:06:41.700</a></span> | <span class="t">Great. So we've gotten the GraphQL query, which has identified essential oils for relaxation as the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=407" target="_blank">00:06:47.540</a></span> | <span class="t">descriptive part of the query, which we want to find in our vector DB by doing a semantic search.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=414" target="_blank">00:06:54.340</a></span> | <span class="t">And we can also see that we have gotten the results for this query. Nice. Let's go over and execute a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=424" target="_blank">00:07:04.180</a></span> | <span class="t">structured query price is a good field to execute a structured query. So let's say, um, actually, show me all</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=432" target="_blank">00:07:12.260</a></span> | <span class="t">products for less than</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=434" target="_blank">00:07:14.900</a></span> | <span class="t">price. 500</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=439" target="_blank">00:07:19.860</a></span> | <span class="t">Wait, so it has rightly identified that there is a price filter with the less than condition.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=453" target="_blank">00:07:33.300</a></span> | <span class="t">And it shows you all the different products with price less than 500. Nice. Let's execute a hybrid query now.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=461" target="_blank">00:07:41.700</a></span> | <span class="t">Let's see, looking for essential oil diffusers in the price range of 500 to 1000 dollars.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=478" target="_blank">00:07:58.100</a></span> | <span class="t">Nice. So we got a GraphQL query where it identified amazing essential oil diffuser as the semantic search</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=487" target="_blank">00:08:07.300</a></span> | <span class="t">query and then the price filter, which is between 500 to 1000 and we received our results. Nice.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=495" target="_blank">00:08:15.460</a></span> | <span class="t">So far we have executed only the happy flows. Um, we have not looked at any other query where of unhappy flows,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=505" target="_blank">00:08:25.700</a></span> | <span class="t">but let's say I had an evil intent and I wanted to execute a malicious query, uh, which is not the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=512" target="_blank">00:08:32.660</a></span> | <span class="t">typical queries that we just looked at. So I have a malicious query. Let's execute this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=519" target="_blank">00:08:39.620</a></span> | <span class="t">So this one is requesting to insert a product of hair hair oil product, um, with the name special oil and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=529" target="_blank">00:08:49.860</a></span> | <span class="t">price of $10,000 category is home. Fantastic hair oil is the description. And let's also add</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=538" target="_blank">00:08:58.900</a></span> | <span class="t">the product ID and say this is 7001. Okay. Let's execute this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=545" target="_blank">00:09:05.380</a></span> | <span class="t">So as you can see, it has generated a GraphQL query of type insert mutation.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=556" target="_blank">00:09:16.180</a></span> | <span class="t">But what we see is that it has also inserted the query. So let's go back to our table and console and look for product ID.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=568" target="_blank">00:09:28.580</a></span> | <span class="t">equal to 7001, which is remove the codes, because this is our integer field. And there you go. We have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=582" target="_blank">00:09:42.020</a></span> | <span class="t">the product, which has gotten inserted into the database. Um, this was not the intended behavior.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=589" target="_blank">00:09:49.300</a></span> | <span class="t">This is not what should have happened. So let us quickly go back to our Hasura console again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=594" target="_blank">00:09:54.900</a></span> | <span class="t">And this time we are going to be defining a new role with very restricted permissions so that we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=600" target="_blank">00:10:00.980</a></span> | <span class="t">only provide select permission and such that this does not happen again. So I'm going to create a new role.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=607" target="_blank">00:10:07.220</a></span> | <span class="t">Let's call it product search</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=609" target="_blank">00:10:09.060</a></span> | <span class="t">bot. And I'm going to provide only search permission. Let's go without any checks. I'm going to keep it</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=617" target="_blank">00:10:17.220</a></span> | <span class="t">really simple. Let me allow all the product, all the columns to be accessible for this role.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=623" target="_blank">00:10:23.380</a></span> | <span class="t">That's about it. Nice. So the role has gotten inserted. Now let's query the same thing with the new role.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=632" target="_blank">00:10:32.100</a></span> | <span class="t">So let's say product search bot. But this time, let me just modify this query a little bit and say</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=640" target="_blank">00:10:40.020</a></span> | <span class="t">seven thousand two. Okay, so let's execute this and see what happens.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=645" target="_blank">00:10:45.220</a></span> | <span class="t">Nice. So we got the same insert mutation query to be generated. But this time there was an error</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=655" target="_blank">00:10:55.460</a></span> | <span class="t">executing this rightly so because we have defined a role which does not have the permission for insert queries.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=664" target="_blank">00:11:04.580</a></span> | <span class="t">Great. So this is all from me. Thank you, everyone.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=667" target="_blank">00:11:07.140</a></span> | <span class="t">Thank you once again. So let us really quickly recap. In this demo, we learned how we can use Hasura</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=674" target="_blank">00:11:14.500</a></span> | <span class="t">to build hybrid query context for your sophisticated RAG applications like product search.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=680" target="_blank">00:11:20.420</a></span> | <span class="t">If you like the demo or would like to use Hasura for your RAG application, please reach out to me.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=pijYURicI1Y&t=685" target="_blank">00:11:25.860</a></span> | <span class="t">These are my contact details and thank you so much.</span></div></div></body></html>