<html><head><title>CI in the Era of AI: From Unit Tests to Stochastic Evals — Nathan Sobo, Zed</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        color: #333;
    }
    .container {
        width: 95%;  /* Increased width to use more space */
        margin: auto;
        overflow: auto;  /* Added to handle overflow by adding a scrollbar if necessary */
    }
    h2, h3 {
        color: #333;
        text-align: center;
    }
    a {
        color: #0000FF;  /* Traditional blue color for links */
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    img {
        display: block;
        margin: auto;
        max-width: 100%;
    }
    .c {
        margin: 10px 0;
    }
    .s, .t {
        display: inline-block;
        margin-right: 5px;
    }
    .max-width {
        max-width: 800px;
        margin: auto;
        padding-left: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;  /* Ensure text alignment is consistent */
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tr:nth-child(odd) {
        background-color: #e6e6e6;
    }
</style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-69VLBMTTP0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-69VLBMTTP0');
    </script>
    </head><body><div class='container'><a href="index.html">back to index</a><h2>CI in the Era of AI: From Unit Tests to Stochastic Evals — Nathan Sobo, Zed</h2><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss"><img src="https://i.ytimg.com/vi_webp/WXy8Yy9xGss/maxresdefault.webp" style="width:50%;"></a><div><br></div><div style="text-align: left;"><a href="./WXy8Yy9xGss.html">Whisper Transcript</a> | <a href="./transcript_WXy8Yy9xGss.html">Transcript Only Page</a></div><br><div style="max-width: 800px;"><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=0" target="_blank">00:00:00.000</a></span> | <span class="t">.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=3" target="_blank">00:00:03.000</a></span> | <span class="t">NATHAN SOBO: Hey, everybody.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=15" target="_blank">00:00:15.640</a></span> | <span class="t">Thanks for coming to my talk.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=18" target="_blank">00:00:18.760</a></span> | <span class="t">I'm Nathan Sobo.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=19" target="_blank">00:00:19.680</a></span> | <span class="t">I'm the co-founder of Zedd.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=21" target="_blank">00:00:21.680</a></span> | <span class="t">We are an AI-enabled code editor.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=24" target="_blank">00:00:24.000</a></span> | <span class="t">And what sets us apart is we are not a fork of VS Code.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=27" target="_blank">00:00:27.240</a></span> | <span class="t">We are implemented from scratch in Rust.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=34" target="_blank">00:00:34.840</a></span> | <span class="t">We literally engineered the entire system like a video game</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=38" target="_blank">00:00:38.060</a></span> | <span class="t">around about 1,200 lines of shader program that run on the GPU.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=41" target="_blank">00:00:41.540</a></span> | <span class="t">And the rest of the system is organized to deliver frames</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=44" target="_blank">00:00:44.540</a></span> | <span class="t">at 120 frames per second really quickly.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=47" target="_blank">00:00:47.160</a></span> | <span class="t">And recently, I recorded a video because time is short.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=50" target="_blank">00:00:50.780</a></span> | <span class="t">And this is obviously sped up massively,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=52" target="_blank">00:00:52.920</a></span> | <span class="t">but we launched agentic editing in Zedd.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=55" target="_blank">00:00:55.360</a></span> | <span class="t">And I wanted to talk about the approach</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=57" target="_blank">00:00:57.180</a></span> | <span class="t">that we took to test this and be empirical</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=61" target="_blank">00:01:01.040</a></span> | <span class="t">and deliver a reliable product that does this effectively.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=64" target="_blank">00:01:04.240</a></span> | <span class="t">So here's what we're going to be talking about.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=66" target="_blank">00:01:06.340</a></span> | <span class="t">The rest of the talk is going to be looking at code</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=68" target="_blank">00:01:08.840</a></span> | <span class="t">and just talking about our experience.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=72" target="_blank">00:01:12.080</a></span> | <span class="t">So testing, evaluation, what's the difference?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=77" target="_blank">00:01:17.840</a></span> | <span class="t">First, I just want to start by saying,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=79" target="_blank">00:01:19.460</a></span> | <span class="t">without an empirical approach to the software that we've been building since 2018, 2021,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=85" target="_blank">00:01:25.140</a></span> | <span class="t">depends on how long you measure it, Zedd would crash every eight seconds.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=89" target="_blank">00:01:29.340</a></span> | <span class="t">Like, we have probably tens of thousands of tests at this point.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=94" target="_blank">00:01:34.040</a></span> | <span class="t">And here's an example of the extreme to which we take empirical software development.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=97" target="_blank">00:01:37.940</a></span> | <span class="t">We literally are starting a server, creating two clients, and we have a simulated scheduler</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=103" target="_blank">00:01:43.620</a></span> | <span class="t">that gets passed in here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=104" target="_blank">00:01:44.740</a></span> | <span class="t">And we run 50 different iterations of this with every random interleaving of anything that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=109" target="_blank">00:01:49.060</a></span> | <span class="t">could possibly be concurrent.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=111" target="_blank">00:01:51.760</a></span> | <span class="t">So that if the 375,000, this is only 50, but iteration of this particular interleaving of network packets</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=121" target="_blank">00:02:01.000</a></span> | <span class="t">goes wrong, we can replay that over and over again, freeze it, and have full control.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=126" target="_blank">00:02:06.040</a></span> | <span class="t">So we're very hardcore about testing and being empirical at Zedd.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=130" target="_blank">00:02:10.000</a></span> | <span class="t">But up until very recently, until shipping some of these AI related features, we've been able to be fully deterministic.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=136" target="_blank">00:02:16.960</a></span> | <span class="t">Even with sort of non-deterministic things, we've been able to really lock things down and never have flaky tests on CI.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=144" target="_blank">00:02:24.140</a></span> | <span class="t">But as soon as an LLM enters the picture, that's all out the window, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=148" target="_blank">00:02:28.080</a></span> | <span class="t">Because we could, assuming that we're using frontier models, but even if we were to use our own model</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=157" target="_blank">00:02:37.140</a></span> | <span class="t">and to control the sampling off the logits, you change one token in the input and you're going to get a completely different output.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=163" target="_blank">00:02:43.960</a></span> | <span class="t">So it's just a fundamentally different problem where we have to embrace stochastic behavior.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=168" target="_blank">00:02:48.820</a></span> | <span class="t">And so as we built this system, our first eval that we really hammered on was something that if you've seen something</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=175" target="_blank">00:02:55.640</a></span> | <span class="t">like Sweebench, probably looks pretty familiar.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=177" target="_blank">00:02:57.520</a></span> | <span class="t">It's very data-driven.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=178" target="_blank">00:02:58.740</a></span> | <span class="t">And it seems like in the machine learning world, this is what an eval is, input, output.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=184" target="_blank">00:03:04.820</a></span> | <span class="t">But in the programmatic software world, an eval is more like a test that passes or fails.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=191" target="_blank">00:03:11.820</a></span> | <span class="t">Like, we come from this very different perspective of automated testing.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=195" target="_blank">00:03:15.620</a></span> | <span class="t">And so right away, you know, we had this traditional data-driven eval and then backing that, you know,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=200" target="_blank">00:03:20.820</a></span> | <span class="t">in the same program that runs all these evals, basically compiles a headless copy of Zed, checks out a repo, runs the agent, tries to make it do things.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=210" target="_blank">00:03:30.820</a></span> | <span class="t">And we right away got into, like, making the eval more programmatic.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=215" target="_blank">00:03:35.680</a></span> | <span class="t">So you can see here the conversation is literally a function.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=218" target="_blank">00:03:38.680</a></span> | <span class="t">And then our ability to sort of come in here and write code that performs assertions about what the agent did, even, you know, getting quite a bit more granular.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=229" target="_blank">00:03:49.680</a></span> | <span class="t">So the problem is when that big eval fails, it's like, what do we do?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=233" target="_blank">00:03:53.680</a></span> | <span class="t">There's a million ways that that thing could go wrong.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=235" target="_blank">00:03:55.820</a></span> | <span class="t">And so when we wrote this eval, we were able to drive out one really simple failure mode, which is when we run the grep tool,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=244" target="_blank">00:04:04.140</a></span> | <span class="t">this is what our original, like, dumb implementation of the grep tool looked like.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=247" target="_blank">00:04:07.940</a></span> | <span class="t">So you can see in this case we're saying we want to add a window argument to this tool run trait method in this particular file name, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=257" target="_blank">00:04:17.800</a></span> | <span class="t">But if this is what the model sees, then we're in trouble, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=261" target="_blank">00:04:21.740</a></span> | <span class="t">And so what we ended up driving from this stochastic test here is a more deterministic test, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=271" target="_blank">00:04:31.080</a></span> | <span class="t">Where I'm going to go ahead and set up the project, perform this search for fn run, and then we use tree sitter,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=279" target="_blank">00:04:39.100</a></span> | <span class="t">which is Max's parsing-- parser generator framework to actually expand out the match to the syntactic boundaries.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=288" target="_blank">00:04:48.440</a></span> | <span class="t">And so that was able to, you know, drive a substantial improvement in the behavior of the agent.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=294" target="_blank">00:04:54.860</a></span> | <span class="t">So right there, like, that was an interesting discovery of just being empirical and driving out what was ultimately an algorithmic problem with a stochastic test.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=304" target="_blank">00:05:04.040</a></span> | <span class="t">But then we moved on to the editing.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=306" target="_blank">00:05:06.300</a></span> | <span class="t">And when we first implemented editing, it was just done with tool calls.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=309" target="_blank">00:05:09.860</a></span> | <span class="t">But the problem with tool calls, if anybody's worked with them, is they don't really stream very well.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=314" target="_blank">00:05:14.400</a></span> | <span class="t">Like, you get key, value, key, value, and it all comes back at once.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=319" target="_blank">00:05:19.840</a></span> | <span class="t">So what we ended up doing is deciding-- instead, we perform a small tool call that just describes the edits.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=326" target="_blank">00:05:26.540</a></span> | <span class="t">Then we loop back around for the moment to just the same model, because it has everything already loaded in its cache,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=332" target="_blank">00:05:32.960</a></span> | <span class="t">and ask it to omit these old text, new text blocks.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=337" target="_blank">00:05:37.520</a></span> | <span class="t">But there's some challenges there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=338" target="_blank">00:05:38.920</a></span> | <span class="t">Like, now we have to parse that data is coming back, and all kinds of weird stuff that the model's going to be doing.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=345" target="_blank">00:05:45.520</a></span> | <span class="t">So I'll just dive in and show you some of the examples.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=349" target="_blank">00:05:49.520</a></span> | <span class="t">So here's like-- there were a bunch of different tests.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=354" target="_blank">00:05:54.080</a></span> | <span class="t">Like, these are part of our main regular old test suite.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=357" target="_blank">00:05:57.160</a></span> | <span class="t">And we just added this eval function.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=359" target="_blank">00:05:59.660</a></span> | <span class="t">And we say, I want to run this eval 200 times.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=362" target="_blank">00:06:02.760</a></span> | <span class="t">And in this particular case, didn't start this way.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=366" target="_blank">00:06:06.080</a></span> | <span class="t">But eventually, we got this way.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=368" target="_blank">00:06:08.360</a></span> | <span class="t">We want 100% of these 200 examples to pass, or this test should, like, literally fail the build.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=374" target="_blank">00:06:14.420</a></span> | <span class="t">And so we kind of set a watermark that way.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=376" target="_blank">00:06:16.760</a></span> | <span class="t">And then here, you can see I'm just, like, loading in a conversation with the LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=382" target="_blank">00:06:22.640</a></span> | <span class="t">And then ultimately, in this case, I'm using eval as judge.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=387" target="_blank">00:06:27.140</a></span> | <span class="t">But there are some cases you saw earlier where we do things more programmatically.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=390" target="_blank">00:06:30.140</a></span> | <span class="t">In this case, we're just, like, verifying if this thing worked correctly.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=394" target="_blank">00:06:34.940</a></span> | <span class="t">And so we go from a test like this, a stochastic test, into the particular problems that drive this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=402" target="_blank">00:06:42.600</a></span> | <span class="t">So, I mean, but it's funny, a lot of the things that went wrong here were really just, like, basic things, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=408" target="_blank">00:06:48.480</a></span> | <span class="t">Like, and so again, these are things that we can-- they're non-deterministic, but the non-determinism is sort of bounded.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=417" target="_blank">00:06:57.340</a></span> | <span class="t">So in this case, we're going to run 100 iterations of this very simple parsing test, where we're randomly chunking up the input</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=425" target="_blank">00:07:05.760</a></span> | <span class="t">into arbitrary boundaries and just making sure that the parser for this data can handle arbitrary chunking of the text.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=435" target="_blank">00:07:15.780</a></span> | <span class="t">Similarly here, fuzzy matching algorithm.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=438" target="_blank">00:07:18.600</a></span> | <span class="t">That's a critical piece of, you know, if the model's fuzzy or generates something slightly wrong, being able to do this dynamic programming that gets us an approximate match</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=451" target="_blank">00:07:31.760</a></span> | <span class="t">really saved a lot of the tool calling failures for us.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=454" target="_blank">00:07:34.640</a></span> | <span class="t">But again, something that could be deterministically tested.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=458" target="_blank">00:07:38.180</a></span> | <span class="t">And then finally, there's this idea of a streaming diff, that as the model is emitting new text,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=463" target="_blank">00:07:43.480</a></span> | <span class="t">we need to be comparing the new text it's emitting with the old text,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=467" target="_blank">00:07:47.400</a></span> | <span class="t">and then making a dynamic decision of, if I don't see some text that was present in the old text,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=474" target="_blank">00:07:54.380</a></span> | <span class="t">is that because it was deleted or it just hasn't been streamed out yet?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=478" target="_blank">00:07:58.740</a></span> | <span class="t">So that's another, you know, completely deterministic thing that still was critical to making the system work correctly.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=486" target="_blank">00:08:06.480</a></span> | <span class="t">So yet another, like, deterministic test.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=489" target="_blank">00:08:09.580</a></span> | <span class="t">But then we get into some of the fun stuff with the behavior of the model itself.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=497" target="_blank">00:08:17.380</a></span> | <span class="t">So one thing that we noticed right away was the model, when it was trying to insert at the top or the end of the document,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=504" target="_blank">00:08:24.920</a></span> | <span class="t">in some cases, would just have an empty old text tag, which, like, if you're doing old text, new text matching is not very useful.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=511" target="_blank">00:08:31.920</a></span> | <span class="t">And so we found that we were able to just add this, you know, simple thing to the prompt and improve the eval.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=519" target="_blank">00:08:39.660</a></span> | <span class="t">But again, it would still do it, you know, 1 or 2% of the time.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=524" target="_blank">00:08:44.720</a></span> | <span class="t">And so just being able to test that, you know, we can handle that case robustly, you know, ended up being really helpful.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=532" target="_blank">00:08:52.660</a></span> | <span class="t">And this is just like, again, I'm in this case simulating the output of the LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=536" target="_blank">00:08:56.760</a></span> | <span class="t">Another case that we encountered a lot was that it would mismatch the XML tags.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=544" target="_blank">00:09:04.500</a></span> | <span class="t">And so we would have old text, and then it would end like this with new text.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=551" target="_blank">00:09:11.060</a></span> | <span class="t">And so, again, we were able to get a certain distance with the prompt.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=554" target="_blank">00:09:14.800</a></span> | <span class="t">We initially were sort of-- 40% of the time we were getting this mismatch and blowing up.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=560" target="_blank">00:09:20.020</a></span> | <span class="t">We were able to move that by saying, always close all tags properly to, like, 95%, but we still have that last, like, 5%.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=569" target="_blank">00:09:29.460</a></span> | <span class="t">What do we do with that?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=570" target="_blank">00:09:30.480</a></span> | <span class="t">And so, again, it's just like driving it into a deterministic test where we have old text, new text, you know, and we need to just assert that even though we got-- you know, we just need to be robust and accept crazy stuff from the LLM, like, in its output.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=588" target="_blank">00:09:48.020</a></span> | <span class="t">And another interesting case was indentation.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=593" target="_blank">00:09:53.160</a></span> | <span class="t">So here's an eval that we wrote, which was this idea of having an outer function, and then inside here there's an inner function.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=600" target="_blank">00:10:00.260</a></span> | <span class="t">And we have this to-do macro here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=602" target="_blank">00:10:02.180</a></span> | <span class="t">And we want to say, replace this to-do with return 42.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=606" target="_blank">00:10:06.060</a></span> | <span class="t">And we would see the model doing things like this, right, where the indentation level was completely flattened out, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=613" target="_blank">00:10:13.200</a></span> | <span class="t">It says, "replace fn_inner," but fn_inner has, like, all this leading indentation on the front of it.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=620" target="_blank">00:10:20.200</a></span> | <span class="t">But otherwise, like, it's perfectly fine.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=622" target="_blank">00:10:22.200</a></span> | <span class="t">And so, in this case, what we did is the strategy of, like, detecting this indent delta.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=628" target="_blank">00:10:28.340</a></span> | <span class="t">So we figure out, basically, sort of renormalize the indent, if that makes sense.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=634" target="_blank">00:10:34.340</a></span> | <span class="t">So if the text in the buffer is indented by a certain amount, but we otherwise match, then we also detect the text that the LLM emitted and compute this delta.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=645" target="_blank">00:10:45.480</a></span> | <span class="t">And then, again, driving it back to a deterministic test of, here, we build a buffer with lorem ipsum doler sit with this very interesting indentation pattern.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=657" target="_blank">00:10:57.620</a></span> | <span class="t">And then you can see here, we want to replace ipsum doler sit with ipsum doler sit amet, where it's out-dented, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=666" target="_blank">00:11:06.620</a></span> | <span class="t">And you can see that when we actually do our indentation normalization, we're able to handle that correctly.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=674" target="_blank">00:11:14.840</a></span> | <span class="t">Another tricky thing that we ran into was this weird escaping behavior, where in these certain cases where we have weird constructs, like, this is a Rust, sort of a raw string, basically, that can include things like quotes inside of it, due to this interesting escaping syntax.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=693" target="_blank">00:11:33.040</a></span> | <span class="t">And doing something as simple as saying, just, like, tweak this, we would notice this is the behavior we want.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=699" target="_blank">00:11:39.700</a></span> | <span class="t">And we would notice, especially Gemini, doing all kinds of crazy stuff, like doing HTML escape codes, doing this sort of backslash escaping.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=710" target="_blank">00:11:50.700</a></span> | <span class="t">Yeah, with new lines and stuff, we would see, like, you know, crazy escaping that it would do, double escaping the new lines.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=718" target="_blank">00:11:58.700</a></span> | <span class="t">And so in this case, like, that was just a pure prompt fix and didn't really-- we didn't try yet, at least, to kind of detect any of this escaping any further.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=730" target="_blank">00:12:10.700</a></span> | <span class="t">Although, obviously, like, that's an opportunity, like, that's an opportunity to keep going even further.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=736" target="_blank">00:12:16.700</a></span> | <span class="t">So, yeah, I mean, from my perspective, like, the lessons we learned from this entire experience is that, like, rigorous testing is fundamental to building reliable software, period.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=749" target="_blank">00:12:29.700</a></span> | <span class="t">We have this new fancy parlance of, like, an eval, which comes, I think, out of the machine learning field of kind of input, output, and having lots of examples of that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=757" target="_blank">00:12:37.700</a></span> | <span class="t">But I think a lot of the techniques of just traditional, good old-fashioned software engineering are still really applicable.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=764" target="_blank">00:12:44.700</a></span> | <span class="t">But we have to embrace this more statistical approach where we're running it 100 times, 200 times, and asserting a threshold of pass versus fail.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=773" target="_blank">00:12:53.700</a></span> | <span class="t">But I think-- I mean, this is a real-world example of just the stuff that we saw trying to implement streaming edits or an agent that can go search and edit.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=783" target="_blank">00:13:03.700</a></span> | <span class="t">A lot of those problems are not-- I don't know.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=786" target="_blank">00:13:06.700</a></span> | <span class="t">They're not advanced machine learning problems or anything.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=789" target="_blank">00:13:09.700</a></span> | <span class="t">It's just stupid things that the model will try to do that we need to account for.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=794" target="_blank">00:13:14.700</a></span> | <span class="t">And so I think this motion of sort of starting with the zoomed-out eval, then zooming into a sort of stochastic unit test that's still random and interacting with the model,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=805" target="_blank">00:13:25.700</a></span> | <span class="t">but is more focused in on a particular aspect of the experience.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=808" target="_blank">00:13:28.700</a></span> | <span class="t">And then, finally, driving that even further to an actual good old-fashioned test, that's been the process that we've discovered.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=816" target="_blank">00:13:36.700</a></span> | <span class="t">But we, so far, haven't needed to use, like, special external tools or eval frameworks or anything like that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=825" target="_blank">00:13:45.700</a></span> | <span class="t">It's just in our test suite so far and kind of using the same underlying infrastructure that's used to do any other kind of software testing</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=833" target="_blank">00:13:53.700</a></span> | <span class="t">and, honestly, using just a lot of those same skills.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=838" target="_blank">00:13:58.700</a></span> | <span class="t">So for us, it was, like, just be empirical, just like we've always been.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=842" target="_blank">00:14:02.700</a></span> | <span class="t">But it's this new X factor of the LLM doing all these crazy things.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=848" target="_blank">00:14:08.700</a></span> | <span class="t">Yeah, so that's a little story of how we-- and this is all open source, so you can check it out.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=855" target="_blank">00:14:15.700</a></span> | <span class="t">Zed is under the GPL license.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=857" target="_blank">00:14:17.700</a></span> | <span class="t">I'd love help improving it all, actually.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=860" target="_blank">00:14:20.700</a></span> | <span class="t">Maybe some of you are like, what are you doing?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=862" target="_blank">00:14:22.700</a></span> | <span class="t">You could do better in the following five ways.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=864" target="_blank">00:14:24.700</a></span> | <span class="t">I'd love contributions if that's interesting to folks.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=867" target="_blank">00:14:27.700</a></span> | <span class="t">And, yeah, it's working.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=870" target="_blank">00:14:30.700</a></span> | <span class="t">I'm-- with the Claude IV models, I'm finally able to write Rust agentically, really efficiently.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=877" target="_blank">00:14:37.700</a></span> | <span class="t">And I'm just loving it.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=879" target="_blank">00:14:39.700</a></span> | <span class="t">So that's how we got there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=881" target="_blank">00:14:41.700</a></span> | <span class="t">I appreciate your attention.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=882" target="_blank">00:14:42.700</a></span> | <span class="t">Thank you.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=883" target="_blank">00:14:43.700</a></span> | <span class="t">Thank you.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=884" target="_blank">00:14:44.700</a></span> | <span class="t">Thank you.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=885" target="_blank">00:14:45.700</a></span> | <span class="t">Thank you.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=886" target="_blank">00:14:46.700</a></span> | <span class="t">Thank you.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=WXy8Yy9xGss&t=887" target="_blank">00:14:47.700</a></span> | <span class="t">I appreciate your attention.</span></div></div></body></html>