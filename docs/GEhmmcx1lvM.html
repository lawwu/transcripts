<html><head><title>Composite Indexes and the Faiss Index Factory</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        color: #333;
    }
    .container {
        width: 80%;
        margin: auto;
        overflow: hidden;
    }
    h2, h3 {
        color: #333;
        text-align: center;
    }
    a {
        color: #0000FF;  /* Traditional blue color for links */
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    img {
        display: block;
        margin: auto;
        max-width: 100%;
    }
    .c {
        margin: 10px 0;
    }
    .s, .t {
        display: inline-block;
        margin-right: 5px;
    }
    .max-width {
        max-width: 800px;
        margin: auto;
        padding-left: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tr:nth-child(odd) {
        background-color: #e6e6e6;
    }
</style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-69VLBMTTP0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-69VLBMTTP0');
    </script>
    </head><body><div class='container'><a href="index.html">back to index</a><h2>Composite Indexes and the Faiss Index Factory</h2><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM"><img src="https://i.ytimg.com/vi_webp/GEhmmcx1lvM/maxresdefault.webp" style="width:50%;"></a><div><br></div><h3>Chapters</h3><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=0">0:0</a> Intro<br><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=114">1:54</a> Composite Indexes<br><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=403">6:43</a> Faiss Index Factory<br><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=694">11:34</a> Why we use Index Factory<br><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1031">17:11</a> Outro<br><br><div style="text-align: left;"><a href="./GEhmmcx1lvM.html">Whisper Transcript</a> | <a href="./transcript_GEhmmcx1lvM.html">Transcript Only Page</a></div><br><div style="max-width: 800px;"><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=0" target="_blank">00:00:00.000</a></span> | <span class="t">And welcome to the next video in our similarity search series. So far we've worked on quite a few</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=8" target="_blank">00:00:08.400</a></span> | <span class="t">different indexes that we can use in FISE for similarity search and through the past</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=15" target="_blank">00:00:15.280</a></span> | <span class="t">few videos and articles we've tested a lot of different indexes and we've sort of tested</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=22" target="_blank">00:00:22.960</a></span> | <span class="t">to see what works and what doesn't work and the sort of pros and cons of each of those indexes.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=30" target="_blank">00:00:30.400</a></span> | <span class="t">Now that's very good and we've had some I think pretty interesting and cool results but in reality</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=38" target="_blank">00:00:38.320</a></span> | <span class="t">the best or the highest performing indexes are all composite indexes. Now composite simply means an</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=47" target="_blank">00:00:47.520</a></span> | <span class="t">index which is built of multiple parts and all state-of-the-art performances are produced by</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=55" target="_blank">00:00:55.600</a></span> | <span class="t">these composite indexes. So what we'll cover in this video is composite indexes at a high level,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=62" target="_blank">00:01:02.960</a></span> | <span class="t">we'll just introduce them. We'll also learn how we can use the FISE index factory function. Now</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=68" target="_blank">00:01:08.720</a></span> | <span class="t">when we're building composite indexes this function is incredibly useful and I would say</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=75" target="_blank">00:01:15.280</a></span> | <span class="t">almost essential. You can build composite indexes without it but it's very difficult and the code is</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=83" target="_blank">00:01:23.680</a></span> | <span class="t">pretty horrific to actually work with. So I think index factory is pretty essential in building</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=91" target="_blank">00:01:31.760</a></span> | <span class="t">these sort of indexes and we'll also explore how we can build a few of the more popular</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=98" target="_blank">00:01:38.400</a></span> | <span class="t">composite indexes as well. So IVF-ADC, Multi-D-ADC and IVF-HMSW indexes and let's explain what all</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=110" target="_blank">00:01:50.960</a></span> | <span class="t">of those are because I know it's just a load of words and letters. So first we want to have a look</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=116" target="_blank">00:01:56.400</a></span> | <span class="t">at the composite components. So the components that we can have within a composite index. So</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=121" target="_blank">00:02:01.920</a></span> | <span class="t">there are two sort of main components that we're pretty much always going to have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=128" target="_blank">00:02:08.480</a></span> | <span class="t">and that is so in the middle we have what is typically a coarse quantizer. So I'll just put</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=136" target="_blank">00:02:16.560</a></span> | <span class="t">coarse here. This is stuff like IVF and we can also use HMSW here and then we pretty much always</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=147" target="_blank">00:02:27.520</a></span> | <span class="t">have another component which is our fine quantizer. Now in terms of fine quantization you're looking</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=155" target="_blank">00:02:35.920</a></span> | <span class="t">at things like product quantization but in this sort of space we would also just include flat</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=163" target="_blank">00:02:43.600</a></span> | <span class="t">vectors. Although that's not really a form of quantization it's just using flat vectors they</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=169" target="_blank">00:02:49.520</a></span> | <span class="t">would be sort of interchangeable. So flat vectors get put into this box not because they are a form</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=176" target="_blank">00:02:56.560</a></span> | <span class="t">of fine quantization but simply because flat vectors would be placed into that position</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=182" target="_blank">00:03:02.480</a></span> | <span class="t">within the index structure. Then the most common addition to these two would be the pre-processing</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=192" target="_blank">00:03:12.320</a></span> | <span class="t">step. So the pre-processing of our vectors and here you have a few things you can have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=199" target="_blank">00:03:19.200</a></span> | <span class="t">PCA which is dimensionality reduction or we can also have OPQ. Now OPQ is optimized product</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=207" target="_blank">00:03:27.840</a></span> | <span class="t">quantization and in order to integrate both of these we would have to have PQ down here as well</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=214" target="_blank">00:03:34.720</a></span> | <span class="t">and all this OPQ step would do is rotate the vectors that are being placed into our index</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=222" target="_blank">00:03:42.320</a></span> | <span class="t">in such a way that it optimizes them for product quantization later on. These three are probably</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=230" target="_blank">00:03:50.080</a></span> | <span class="t">the most common ones but we also have another block as well and that comes at the end here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=236" target="_blank">00:03:56.400</a></span> | <span class="t">This is a sort of like a refinement step. All throughout here we've sort of built our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=243" target="_blank">00:04:03.600</a></span> | <span class="t">approximate search and then we return top 10k or top 10,000 most relevant results according</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=252" target="_blank">00:04:12.880</a></span> | <span class="t">to our approximate search and then we perform an exhaustive search at the end which will</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=257" target="_blank">00:04:17.920</a></span> | <span class="t">re-rank them based on a more definitive, I would say, search. Here's just a few examples of that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=267" target="_blank">00:04:27.600</a></span> | <span class="t">So we have the vector transform, coarse quantizer, fine quantizer and refinement steps there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=274" target="_blank">00:04:34.240</a></span> | <span class="t">So for example what we might do is when the vectors are incoming we transform them,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=281" target="_blank">00:04:41.920</a></span> | <span class="t">we rotate them using OPQ, then we perform coarse quantization and assign all of those</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=291" target="_blank">00:04:51.360</a></span> | <span class="t">incoming vectors, those rotated vectors now, into different lists within a IVF index.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=298" target="_blank">00:04:58.480</a></span> | <span class="t">Once they've been assigned to their different clusters or cells we use product quantization</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=306" target="_blank">00:05:06.800</a></span> | <span class="t">to compress them and reduce the memory usage of our index. And then when it comes to search time</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=313" target="_blank">00:05:13.920</a></span> | <span class="t">what we might want to do is use a refinement step which would take the full vectors which in this</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=322" target="_blank">00:05:22.080</a></span> | <span class="t">case would not allow us to reduce the memory usage of our index significantly. But we could</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=330" target="_blank">00:05:30.560</a></span> | <span class="t">add a PQ refinement step here so those vectors are stored as their quantized forms or compressed</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=338" target="_blank">00:05:38.880</a></span> | <span class="t">forms rather than flat vectors, whichever way works for your index. During our search we would</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=345" target="_blank">00:05:45.920</a></span> | <span class="t">go through each of these steps and turn the top 10,000 items, so the top 10k, and using our final</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=356" target="_blank">00:05:56.160</a></span> | <span class="t">refinement step rather than using IVF we would just take the Euclidean distance or the L2 distance</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=363" target="_blank">00:06:03.440</a></span> | <span class="t">between all of them and find the ones that are most similar. And this is an example of that,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=369" target="_blank">00:06:09.840</a></span> | <span class="t">so this is IVF PQ, this is an example of the two middle parts of that, so IVF and PQ,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=378" target="_blank">00:06:18.240</a></span> | <span class="t">we are excluding the re-ranking and excluding the OPQ part. And what we're doing here is we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=387" target="_blank">00:06:27.440</a></span> | <span class="t">take our original vector, we assign it to an IVF cell, and then we also take that original vector</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=393" target="_blank">00:06:33.280</a></span> | <span class="t">in a separate almost stream, we quantize it, convert them into the codes, and place that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=402" target="_blank">00:06:42.000</a></span> | <span class="t">under the IVF cell assignment. Now I think that's plenty for an introduction to CompCert Index,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=411" target="_blank">00:06:51.200</a></span> | <span class="t">let's move on to how we start building them using the Index Factory. Okay, so here I'm just</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=419" target="_blank">00:06:59.680</a></span> | <span class="t">importing our data, we're using the CIFT1M data set as we usually do. If you don't have that,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=427" target="_blank">00:07:07.440</a></span> | <span class="t">there will be a link in the description to the download script for that. And I've also</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=433" target="_blank">00:07:13.520</a></span> | <span class="t">also just imported FICE up here. So the first thing I'm going to do is show you the difference</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=440" target="_blank">00:07:20.560</a></span> | <span class="t">between building an index with the non-method that we've been using in every previous article and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=448" target="_blank">00:07:28.960</a></span> | <span class="t">video and how we can do the same using the Index Factory. So what we need to do is we write</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=456" target="_blank">00:07:36.080</a></span> | <span class="t">Quantizer, FICE, and in here I'm going to write Index Flat L2. So this is because we're using the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=465" target="_blank">00:07:45.360</a></span> | <span class="t">flat vectors. Again, like I said before, the flat vectors are in the place of where we would put a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=472" target="_blank">00:07:52.800</a></span> | <span class="t">fine quantizer usually, but they themselves are not actually a fine quantizer. And then to build</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=480" target="_blank">00:08:00.480</a></span> | <span class="t">our index from that, we would write FICE, and this is our Index Flat IVF, or IVF Flat.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=489" target="_blank">00:08:09.760</a></span> | <span class="t">And in here we first pass our quantizer, then our dimensionality, and then we pass NList,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=499" target="_blank">00:08:19.840</a></span> | <span class="t">which is the number of Voronoi cells or oculus that we want to include in our IVF list. Okay,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=507" target="_blank">00:08:27.040</a></span> | <span class="t">after that we add our vectors. Actually, we train them first, so we train on those vectors,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=514" target="_blank">00:08:34.720</a></span> | <span class="t">and then we add them. Okay, do I need to, oh, I need to rerun this. Okay,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=525" target="_blank">00:08:45.200</a></span> | <span class="t">run that and run this again. Once we have those, we can do search like we usually do,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=536" target="_blank">00:08:56.080</a></span> | <span class="t">and that's how we build our index and then add data to it. So that's the usual approach. Using</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=543" target="_blank">00:09:03.680</a></span> | <span class="t">the Index Factory approach is slightly different. So what we do is instead we write, I'm going to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=549" target="_blank">00:09:09.840</a></span> | <span class="t">write Index F just so we can compare the two indexes later on, and all we need to write is</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=555" target="_blank">00:09:15.600</a></span> | <span class="t">FICE. We call it Index Factory Function, and in here we need to pass the dimensionality of our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=562" target="_blank">00:09:22.960</a></span> | <span class="t">vectors like we usually do, but then we pass this, it's called an Index Factory String,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=569" target="_blank">00:09:29.120</a></span> | <span class="t">and in here we specify the structure of the index that we'd like to build.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=576" target="_blank">00:09:36.640</a></span> | <span class="t">So we're going to say IVF256, so an IVF index with 256 cells, followed by, or which contains</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=588" target="_blank">00:09:48.400</a></span> | <span class="t">flat vectors, and that's it. So we can run that, and then we do the same thing again. We do Index</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=594" target="_blank">00:09:54.960</a></span> | <span class="t">F train XB, and Index F add XB, like so. And that should work. So once we've done that,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=607" target="_blank">00:10:07.680</a></span> | <span class="t">what I want to show you is that they do in fact output the exact same results. So we need to do</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=615" target="_blank">00:10:15.920</a></span> | <span class="t">DI, so what we normally do, index.search, XQ, K. K I haven't defined, let's go with 100,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=623" target="_blank">00:10:23.520</a></span> | <span class="t">or let's go 10, because so we can actually see the results.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=629" target="_blank">00:10:29.360</a></span> | <span class="t">Okay, and then let's do the same, but for Index F, which is our Index Factory Index.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=640" target="_blank">00:10:40.880</a></span> | <span class="t">So here we just replace index with Index F,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=644" target="_blank">00:10:44.080</a></span> | <span class="t">and you should see the same thing again. I'm going to just replace these as well.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=649" target="_blank">00:10:49.600</a></span> | <span class="t">Okay, and I mean, we can see they're exactly the same. There's no difference between them. So we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=659" target="_blank">00:10:59.840</a></span> | <span class="t">were returning the same nearest neighbors using both. So they are the same indexes is what I'm</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=666" target="_blank">00:11:06.480</a></span> | <span class="t">trying to point out here. The search time is pretty much the same. I always find it's like</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=673" target="_blank">00:11:13.040</a></span> | <span class="t">very slightly faster when you use Index Factory, but I mean very slightly. It's on like micro</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=680" target="_blank">00:11:20.880</a></span> | <span class="t">scale value, like maybe five microseconds faster, which is obviously not that much.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=686" target="_blank">00:11:26.800</a></span> | <span class="t">And in terms of memory uses, they're both exactly the same as well. So that's a very simple example,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=695" target="_blank">00:11:35.440</a></span> | <span class="t">but obviously when we start building more complex indexes, the Index Factory becomes a lot more</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=702" target="_blank">00:11:42.160</a></span> | <span class="t">useful. So let me show you a good example of why we'd use Index Factory, e.g. let's put together</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=710" target="_blank">00:11:50.880</a></span> | <span class="t">a more complex, a more complex index, and we'll see the difference between the two approaches.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=716" target="_blank">00:11:56.960</a></span> | <span class="t">Okay, so I've just pulled this code in here, and this is, I said before, I have those kind of like</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=723" target="_blank">00:12:03.920</a></span> | <span class="t">four different components that we can have. We have pre-processing, and we have like the coarse</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=729" target="_blank">00:12:09.200</a></span> | <span class="t">and fine quantizer. So the fine quantizer here, I'll just rename this as Vex because it's not</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=737" target="_blank">00:12:17.280</a></span> | <span class="t">really a quantizer, so it's just a flat vectors. And then we also have the set that comes after</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=744" target="_blank">00:12:24.640</a></span> | <span class="t">where we're re-ranking the vectors as well. And I also need to add that in. So it's just</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=750" target="_blank">00:12:30.080</a></span> | <span class="t">index equals vice index refine flat, and in here we have to pass all, well we have to pass this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=758" target="_blank">00:12:38.880</a></span> | <span class="t">So I'm going to rename that to Q and add it in here. So here we're building our index like we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=765" target="_blank">00:12:45.040</a></span> | <span class="t">usually do. So we've got our rotation, OPQ rotation, which is a pre-processing set, and then</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=771" target="_blank">00:12:51.280</a></span> | <span class="t">we go on to our IVF. So we're putting, sorting those out into different cells, and we are using</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=779" target="_blank">00:12:59.360</a></span> | <span class="t">the fine quantizer, it's not really a quantizer, it's the flat vectors, and then we're merging all</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=785" target="_blank">00:13:05.120</a></span> | <span class="t">of those together into this sort of merged almost proto-index. We could use this as an index, but</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=795" target="_blank">00:13:15.280</a></span> | <span class="t">then we want to add another post-processing set, which is a re-ranking, which is what we've done</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=801" target="_blank">00:13:21.520</a></span> | <span class="t">there. Okay, and I mean all this code is quite complicated, I mean at least to me it's not that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=809" target="_blank">00:13:29.680</a></span> | <span class="t">easy to read, there's a lot going on. So running up, it can take a little bit of time to build,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=816" target="_blank">00:13:36.160</a></span> | <span class="t">to be honest, and maybe it's better if I use less data. I think it's fine for now. If it takes too</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=827" target="_blank">00:13:47.520</a></span> | <span class="t">long I'll reduce how much data we have. And if we wanted to rebuild this in using the index factory,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=835" target="_blank">00:13:55.680</a></span> | <span class="t">it's super simple. All we do is we write index equals FICE index factory, so literally we're</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=845" target="_blank">00:14:05.040</a></span> | <span class="t">going to do this on one line and pretty much all of this. Index factory, and we have our dimensionality</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=851" target="_blank">00:14:11.920</a></span> | <span class="t">D, and then we have our string. So first we have the OPQ set, so the pre-processing set.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=859" target="_blank">00:14:19.120</a></span> | <span class="t">In there we're using an M value of 32. Then that goes on to our IVF set, so we're using IVF there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=871" target="_blank">00:14:31.840</a></span> | <span class="t">We are using an endless value of 256. That's flat. Okay, I've just added these,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=881" target="_blank">00:14:41.120</a></span> | <span class="t">so it's not training for too long, I've added these in here. So here we're not using flat,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=889" target="_blank">00:14:49.840</a></span> | <span class="t">so we're using flat vectors here, but then we're using IVF PQ. So this is actually PQ, and we're</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=898" target="_blank">00:14:58.800</a></span> | <span class="t">using M here, so M is 32 up here. And then the next step after that is our re-indexing or</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=910" target="_blank">00:15:10.800</a></span> | <span class="t">refinement step, and that's just R flat like this. And that's it. That's the whole, what we wrote,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=921" target="_blank">00:15:21.680</a></span> | <span class="t">all of this, we compress it into the single line with the index factory, which is why when you're</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=928" target="_blank">00:15:28.800</a></span> | <span class="t">doing the more complicated stuff, or at least when you start using composite indexes, I think</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=936" target="_blank">00:15:36.320</a></span> | <span class="t">index factory is practically an essential. Missing it is, or try and do it without,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=944" target="_blank">00:15:44.160</a></span> | <span class="t">is you can do it of course, like we showed here, you can, but it's difficult. And it gets a lot</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=950" target="_blank">00:15:50.880</a></span> | <span class="t">more complicated than this as well. So I think it's probably the best approach, in my opinion,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=957" target="_blank">00:15:57.200</a></span> | <span class="t">at least. Now, if we train and do the same again, where I'm just doing the first 50k,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=964" target="_blank">00:16:04.880</a></span> | <span class="t">which is still taking forever, maybe because we're recording at the same time.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=974" target="_blank">00:16:14.960</a></span> | <span class="t">Okay. And what I'm just going to do here is di equals index search. And then we can,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=982" target="_blank">00:16:22.400</a></span> | <span class="t">again, we just see what we return and make sure they match. Okay. And let's have a look at what</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=991" target="_blank">00:16:31.840</a></span> | <span class="t">we have. Let's print out i before we lose it. And we do the same here. So, and we'll just do</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1000" target="_blank">00:16:40.560</a></span> | <span class="t">the search as well. Index search, xqk. And again, we just want to see i. Okay. And that's finished.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1012" target="_blank">00:16:52.160</a></span> | <span class="t">And we can see, so we compare those results and they are exactly the same, which is what we'd</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1018" target="_blank">00:16:58.640</a></span> | <span class="t">expect because we are building the same index. So from this to this using the index factory. So I</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1025" target="_blank">00:17:05.840</a></span> | <span class="t">think it's fair to say there is good reason to use it when you're building these composite indexes.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1032" target="_blank">00:17:12.640</a></span> | <span class="t">Now in the next video, we're going to be covering the composite indexes and how we can build them</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1040" target="_blank">00:17:20.240</a></span> | <span class="t">using the index factory. Now, if you are watching this on YouTube, it's the next video in the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1047" target="_blank">00:17:27.920</a></span> | <span class="t">playlist. Otherwise, if you're on, if you're over on Pinecone reading the article, it's below. So</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=GEhmmcx1lvM&t=1055" target="_blank">00:17:35.200</a></span> | <span class="t">you can read about it or watch it there. So thank you very much for watching and I'll see you in</span></div></div></body></html>