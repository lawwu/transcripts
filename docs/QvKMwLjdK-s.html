<html><head><title>HNSW for Vector Search Explained and Implemented with Faiss (Python)</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        color: #333;
    }
    .container {
        width: 80%;
        margin: auto;
        overflow: hidden;
    }
    h2, h3 {
        color: #333;
        text-align: center;
    }
    a {
        color: #0000FF;  /* Traditional blue color for links */
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    img {
        display: block;
        margin: auto;
        max-width: 100%;
    }
    .c {
        margin: 10px 0;
    }
    .s, .t {
        display: inline-block;
        margin-right: 5px;
    }
    .max-width {
        max-width: 800px;
        margin: auto;
        padding-left: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tr:nth-child(odd) {
        background-color: #e6e6e6;
    }
</style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-69VLBMTTP0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-69VLBMTTP0');
    </script>
    </head><body><div class='container'><a href="index.html">back to index</a><h2>HNSW for Vector Search Explained and Implemented with Faiss (Python)</h2><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s"><img src="https://i.ytimg.com/vi_webp/QvKMwLjdK-s/maxresdefault.webp" style="width:50%;"></a><div><br></div><h3>Chapters</h3><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=0">0:0</a> Intro<br><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=41">0:41</a> Foundations of HNSW<br><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=521">8:41</a> How HNSW Works<br><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=998">16:38</a> The Basics of HNSW in Faiss<br><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1300">21:40</a> How Faiss Builds an HNSW Graph<br><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2013">33:33</a> Fine-tuning HNSW<br><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2070">34:30</a> Outro<br><br><div style="text-align: left;"><a href="./QvKMwLjdK-s.html">Whisper Transcript</a> | <a href="./transcript_QvKMwLjdK-s.html">Transcript Only Page</a></div><br><div style="max-width: 800px;"><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=0" target="_blank">00:00:00.000</a></span> | <span class="t">Hi and welcome to the video. We're going to be having a look at the Hierarchical Navigable Small</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=6" target="_blank">00:00:06.080</a></span> | <span class="t">Worlds graph or HNSW graph and how it's used in vector search. Now HNSW is one of the best</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=17" target="_blank">00:00:17.520</a></span> | <span class="t">performing algorithms for approximate nearest neighbors search and what I want to do with this</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=25" target="_blank">00:00:25.520</a></span> | <span class="t">video is explore how it works and how we can implement it in FICE. So let's go ahead and get</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=35" target="_blank">00:00:35.200</a></span> | <span class="t">started. Now we'll start with the sort of foundations of HNSW and where it comes from.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=46" target="_blank">00:00:46.800</a></span> | <span class="t">So we can split approximate nearest neighbor algorithms into three broad categories. Trees,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=54" target="_blank">00:00:54.960</a></span> | <span class="t">hashes, and graphs. Now HNSW, it was HNSW graph so we can figure out it probably belongs in the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=62" target="_blank">00:01:02.800</a></span> | <span class="t">graph category and more specifically it's a type of proximity graph which is it simply</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=69" target="_blank">00:01:09.600</a></span> | <span class="t">means that vertices which are just the vectors in our graph or the nodes in our graph</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=76" target="_blank">00:01:16.720</a></span> | <span class="t">are connected to other nodes or vertices based on their proximity and we would typically</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=84" target="_blank">00:01:24.160</a></span> | <span class="t">measure this proximity using Euclidean distance. We don't have to but that's the sort of standard.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=92" target="_blank">00:01:32.720</a></span> | <span class="t">Now going from a proximity graph which is pretty simple to a HNSW graph is a pretty big leap</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=102" target="_blank">00:01:42.880</a></span> | <span class="t">and there's two main algorithms that have really helped me understand what HNSW actually does and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=112" target="_blank">00:01:52.880</a></span> | <span class="t">that is the probability skip list and the navigable small world graphs which are just</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=118" target="_blank">00:01:58.800</a></span> | <span class="t">the predecessors of HNSW. So what I'm going to do is just quickly you know run through those</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=127" target="_blank">00:02:07.680</a></span> | <span class="t">two algorithms. So this is a probability skip list. It's reasonably old. It was introduced in</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=135" target="_blank">00:02:15.840</a></span> | <span class="t">1990 by a guy called William Poog and it works by building several layers of linked list which</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=143" target="_blank">00:02:23.520</a></span> | <span class="t">is what you can see up here. So what we do with this is we we're looking for the number 11 or the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=150" target="_blank">00:02:30.400</a></span> | <span class="t">key 11 and we saw over here the top layer of our start block and what we do is we say in our layer</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=160" target="_blank">00:02:40.320</a></span> | <span class="t">3 which is our entry layer and we move across. So we go over to the next block here and we say okay</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=168" target="_blank">00:02:48.800</a></span> | <span class="t">number 11 is not 5 and 5 is not greater than 11. So we continue and we go all the way over to the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=177" target="_blank">00:02:57.360</a></span> | <span class="t">end block over here. Once we reach the end block we know that we need to go to the next layer so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=185" target="_blank">00:03:05.280</a></span> | <span class="t">one layer down and so we do that we go to layer 2 at the start block again and we continue moving</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=194" target="_blank">00:03:14.480</a></span> | <span class="t">across. Now at this point we get to block 19 over here and we say okay 19 is a great 11 so now we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=203" target="_blank">00:03:23.760</a></span> | <span class="t">know that we need to go on to our next layer, layer 1 down here and then we go across and we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=210" target="_blank">00:03:30.640</a></span> | <span class="t">find number 11. Now the whole point of this is when we have a lot of values this can reduce the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=219" target="_blank">00:03:39.600</a></span> | <span class="t">number of steps we need to take in order to get to our final value rather than just going along</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=226" target="_blank">00:03:46.000</a></span> | <span class="t">our layer 0 and going along every single value within our list. HNSW borrows this hierarchical</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=237" target="_blank">00:03:57.360</a></span> | <span class="t">layered format or levels as we will see pretty soon. Navigable Small World or NSW graphs were</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=245" target="_blank">00:04:05.600</a></span> | <span class="t">developed over the course of a few papers around 2011 up to 2014. The basic idea is that we can</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=255" target="_blank">00:04:15.920</a></span> | <span class="t">have a very large graph with many vertices and because we have both short range links so the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=267" target="_blank">00:04:27.440</a></span> | <span class="t">sort of links that you see on the outside of our circle here and we also have these long range</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=273" target="_blank">00:04:33.600</a></span> | <span class="t">links which is what you see going across the circle we make our graph very navigable so it's</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=280" target="_blank">00:04:40.480</a></span> | <span class="t">very easy to get from one point to another in very few steps and there's some terminology that we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=287" target="_blank">00:04:47.600</a></span> | <span class="t">should cover here which is the all the vertices we have here all of their connections so all the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=294" target="_blank">00:04:54.640</a></span> | <span class="t">other vertices that they are connected to we refer to these as that vertex's friends list okay and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=304" target="_blank">00:05:04.160</a></span> | <span class="t">when searching this NSW graph we begin at a predetermined entry point so in here we see</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=311" target="_blank">00:05:11.440</a></span> | <span class="t">we're sort of sawing a few different points but in reality with these sort of big graphs we always</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=318" target="_blank">00:05:18.160</a></span> | <span class="t">start with one specific entry point or maybe sometimes we can do use different entry points</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=325" target="_blank">00:05:25.440</a></span> | <span class="t">based on some sort of logic but we have either one or if only a few entry points in our graph</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=334" target="_blank">00:05:34.320</a></span> | <span class="t">and then what we do is we perform what is called greedy routing now routing just refers to the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=343" target="_blank">00:05:43.520</a></span> | <span class="t">route that we take through our graph and greedy refers to the fact that we are always going to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=349" target="_blank">00:05:49.360</a></span> | <span class="t">choose out of our vertices friend list we're going to choose the friend that is the closest to our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=359" target="_blank">00:05:59.040</a></span> | <span class="t">target vertex now if we find that there are no near vertices in our friend list this is a local</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=369" target="_blank">00:06:09.760</a></span> | <span class="t">minimum and this is our stopping condition we cannot get any closer we're kind of stuck in</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=376" target="_blank">00:06:16.400</a></span> | <span class="t">in that local minimum now if our vertex has very few friends we can get stuck</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=384" target="_blank">00:06:24.320</a></span> | <span class="t">quite easily so we can get stuck in the local minimum if there are less connections</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=388" target="_blank">00:06:28.960</a></span> | <span class="t">and we actually refer to vertices that have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=400" target="_blank">00:06:40.080</a></span> | <span class="t">fewer friends as a low degree vertex so it's low degree it means it has a low number of links or</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=408" target="_blank">00:06:48.160</a></span> | <span class="t">edges and then we also have high degree vertices now with these it's if we are currently on a high</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=417" target="_blank">00:06:57.440</a></span> | <span class="t">degree vertex it's harder to get stuck in local minimum because we have more options on where we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=422" target="_blank">00:07:02.480</a></span> | <span class="t">can where we can move now the routing through a navigable small world graph is split into two</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=429" target="_blank">00:07:09.520</a></span> | <span class="t">phases so we have the typically the earlier zoom out phase where we are passing through vertices</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=438" target="_blank">00:07:18.720</a></span> | <span class="t">that have a low number of links and then we also have the zoom in phase where we are passing through</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=448" target="_blank">00:07:28.320</a></span> | <span class="t">high degree vertices which have a lot of links and what we tend to find is a high degree vertices</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=455" target="_blank">00:07:35.280</a></span> | <span class="t">will usually have more long range links so we can move further across our graph with these</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=462" target="_blank">00:07:42.160</a></span> | <span class="t">high degree vertices now to minimize the probability of stopping early so avoiding</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=469" target="_blank">00:07:49.120</a></span> | <span class="t">those local minima we can increase the average degree of our vertices now this also increases</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=479" target="_blank">00:07:59.520</a></span> | <span class="t">the complexity of our network and therefore slows down our search time so we have to find a balance</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=487" target="_blank">00:08:07.360</a></span> | <span class="t">between both of those now another approach to avoiding hitting a local minima too early</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=494" target="_blank">00:08:14.800</a></span> | <span class="t">is to start search on high degree vertices so the vertices which have a lot of connections now</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=502" target="_blank">00:08:22.960</a></span> | <span class="t">for nsw we can do this and it works it works for low dimensional data but it doesn't work perfectly</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=512" target="_blank">00:08:32.400</a></span> | <span class="t">and it's actually one of the key factors that hnsw improves upon and uses to improve its own</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=520" target="_blank">00:08:40.560</a></span> | <span class="t">performance so let's move on to to hsw and how both this fit into hsw so hsw is obviously a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=530" target="_blank">00:08:50.480</a></span> | <span class="t">an evolution of nsw and it borrows inspiration from poops probability skip list structure with</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=539" target="_blank">00:08:59.280</a></span> | <span class="t">the with the hierarchy so you can you can see that here we have a few different layers so we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=544" target="_blank">00:09:04.720</a></span> | <span class="t">have our entry layer just like we did with the probability skip list structure and we also have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=552" target="_blank">00:09:12.160</a></span> | <span class="t">an entry point and what we've basically done here is taken a navigable small nsw graph and split it</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=560" target="_blank">00:09:20.720</a></span> | <span class="t">across multiple layers so high vertex high degree vertices will tend to be spread across more layers</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=572" target="_blank">00:09:32.400</a></span> | <span class="t">because when we're building our graph we add the number of friends based on which layer it gets</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=581" target="_blank">00:09:41.520</a></span> | <span class="t">inserted at the higher the layer that the vertex is inserted at the more friends it's going to have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=588" target="_blank">00:09:48.480</a></span> | <span class="t">which makes a high degree vertex and what that does is if we start at that highest layer that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=595" target="_blank">00:09:55.360</a></span> | <span class="t">means we're on high degree vertices so we are less likely to get stuck in the local minimum</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=601" target="_blank">00:10:01.520</a></span> | <span class="t">and that means we're not going to stop early so that allows us to start the top layer and we move</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=608" target="_blank">00:10:08.080</a></span> | <span class="t">through our graph and what we do is we have our query vector and on each layer we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=617" target="_blank">00:10:17.200</a></span> | <span class="t">keep moving or traversing across different edges in that layer in essentially the same way we did</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=625" target="_blank">00:10:25.280</a></span> | <span class="t">for an sw so we greedily identify the friend of our current vertex that has the least distance</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=634" target="_blank">00:10:34.560</a></span> | <span class="t">from our query vector and we move to that and then we we keep doing that and once we hit a local</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=642" target="_blank">00:10:42.640</a></span> | <span class="t">minimum we we don't stop the whole thing we just move down to the next layer and then we we do it</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=650" target="_blank">00:10:50.720</a></span> | <span class="t">again and we keep doing that until we reach the local minimum of layer zero and that is our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=658" target="_blank">00:10:58.800</a></span> | <span class="t">stopping condition that's where we stop now that that's how we search that's what our graph looks</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=663" target="_blank">00:11:03.840</a></span> | <span class="t">like and how we search but let's have a quick look at how we actually build that graph so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=669" target="_blank">00:11:09.360</a></span> | <span class="t">what we do is we have a probability function which essentially says we're pretty much going</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=679" target="_blank">00:11:19.040</a></span> | <span class="t">to put every vertex or every vector on layer zero not every but a pretty high number of them as we'll</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=686" target="_blank">00:11:26.880</a></span> | <span class="t">see later and we say okay we get a uniform a random number from uniform distribution</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=695" target="_blank">00:11:35.360</a></span> | <span class="t">and if that number is greater than our probability for that level we move on to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=702" target="_blank">00:11:42.720</a></span> | <span class="t">the next layer so we increment our layer so let's say this turns out to not be true we move up a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=713" target="_blank">00:11:53.280</a></span> | <span class="t">layer and we we try again okay now this next layer is going to have lower probability but we're also</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=719" target="_blank">00:11:59.920</a></span> | <span class="t">going to subtract the probability value from our lower layer from the random number that we've</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=728" target="_blank">00:12:08.400</a></span> | <span class="t">produced and we keep doing this again and again until we get up to our top layer at that point</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=735" target="_blank">00:12:15.200</a></span> | <span class="t">there are no other layers this is very unlikely to happen if we say if we have a billion maybe</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=743" target="_blank">00:12:23.280</a></span> | <span class="t">not a billion like a hundred i think it was a hundred million vectors i tried this with</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=748" target="_blank">00:12:28.400</a></span> | <span class="t">i got i think four vectors on the top layer so it is it's very unlikely for one vector to go all the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=756" target="_blank">00:12:36.640</a></span> | <span class="t">way up to the top but if it does we insert it at that layer and it has the possibility of becoming</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=763" target="_blank">00:12:43.600</a></span> | <span class="t">a entry point for our graph one other thing that we we also have here is the the ml at the top</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=770" target="_blank">00:12:50.480</a></span> | <span class="t">now this is called the level multiplier and this value is it's just a normalization value</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=779" target="_blank">00:12:59.600</a></span> | <span class="t">which allows us to modify the probability or the probability distribution across each one of our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=786" target="_blank">00:13:06.400</a></span> | <span class="t">layers now the the creators of hsw they found that the the best value for ml the optimum value</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=796" target="_blank">00:13:16.320</a></span> | <span class="t">was to use one over the natural logarithm of m and m we'll we'll have a look at that pretty soon</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=805" target="_blank">00:13:25.520</a></span> | <span class="t">that's just the number of neighbors each vertex is assigned so here we have we we have m so we've set</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=813" target="_blank">00:13:33.760</a></span> | <span class="t">m to three and we we're saying here so we want to insert this blue vector so that blue vector you</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=824" target="_blank">00:13:44.720</a></span> | <span class="t">see we've decided okay we're going to insert at layer one that means it gets an insert of it both</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=831" target="_blank">00:13:51.520</a></span> | <span class="t">layer one and layer zero but not at layer two and we we go through our graph just like we do when we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=841" target="_blank">00:14:01.920</a></span> | <span class="t">search but this time we're we're trying to find many neighbors of our new vertex that we can assign</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=851" target="_blank">00:14:11.280</a></span> | <span class="t">to it's friendless and what we have here is so with an m value of three we would add three neighbors</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=862" target="_blank">00:14:22.400</a></span> | <span class="t">to that vertex both on layer one and also on layer zero now we can also have a m m max value and an</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=872" target="_blank">00:14:32.640</a></span> | <span class="t">m max zero value which is what we have down here and basically as more vertices are added we may</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=886" target="_blank">00:14:46.000</a></span> | <span class="t">find that this vertex ends up with more than three friends and maybe that that's fine but</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=895" target="_blank">00:14:55.280</a></span> | <span class="t">what we essentially do is use m max to say okay if we have any vertices with more than this number</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=903" target="_blank">00:15:03.280</a></span> | <span class="t">of friends we need to trim it and we need to just keep the closest like three in this example</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=910" target="_blank">00:15:10.400</a></span> | <span class="t">and then m max zero is another value and that is the same so it's the maximum number of friends</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=917" target="_blank">00:15:17.760</a></span> | <span class="t">of vertex you have but for layer zero which is i think always a higher number than the other layers</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=925" target="_blank">00:15:25.600</a></span> | <span class="t">now one other thing that we we should cover very quickly is we also have two more variables ef</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=933" target="_blank">00:15:33.200</a></span> | <span class="t">construction ef search now ef construction is used on we're building our graph and it's basically</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=940" target="_blank">00:15:40.400</a></span> | <span class="t">the number of friends of our inserted vertex that we will use when traversing across layers so in</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=950" target="_blank">00:15:50.800</a></span> | <span class="t">layer one up here we we have these three friends and that means that during our search for</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=957" target="_blank">00:15:57.840</a></span> | <span class="t">friends in the low layers we would go down like this we would start our search from each of these</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=966" target="_blank">00:16:06.720</a></span> | <span class="t">three vertices in the lower layer okay now that would be the case for all of those</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=976" target="_blank">00:16:16.000</a></span> | <span class="t">and ef search is the same but it's used during search time to search through our graph</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=981" target="_blank">00:16:21.360</a></span> | <span class="t">and i mean that they're pretty much that's pretty much all we need to know</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=987" target="_blank">00:16:27.520</a></span> | <span class="t">in on the theory side of hsw so let's dive into the implementation of hsw in advice</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=999" target="_blank">00:16:39.680</a></span> | <span class="t">okay so in we're in python now all i've done is taken our data so i'm using the sift 1m data set</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1007" target="_blank">00:16:47.440</a></span> | <span class="t">as we as we usually do and all i'm going to do is use this to you know search throughout our index</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1015" target="_blank">00:16:55.440</a></span> | <span class="t">as always now the first thing we want to do is actually create or initialize our index so i'm</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1022" target="_blank">00:17:02.400</a></span> | <span class="t">going to use two parameters so we have d which is the dimensionality the sift 1m data set so the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1029" target="_blank">00:17:09.200</a></span> | <span class="t">length of our vectors in there and also m now m if you remember that's the number of neighbors</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1036" target="_blank">00:17:16.880</a></span> | <span class="t">that we will assign to each vertex in our graph now for this i'm going to use a value of 32</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1044" target="_blank">00:17:24.080</a></span> | <span class="t">and what we can now do is we write index equals advice</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1054" target="_blank">00:17:34.000</a></span> | <span class="t">index flat hsw and then we just passed dnm and that's you know we've initialized</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1063" target="_blank">00:17:43.360</a></span> | <span class="t">okay sorry so it's not flat hsw it's hsw flat okay there we go so with that we have initialized our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1079" target="_blank">00:17:59.120</a></span> | <span class="t">index of course there's nothing in there at the moment and we can see that so we can go ahead and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1086" target="_blank">00:18:06.240</a></span> | <span class="t">write index hsw max level to see okay how many levels do we have in our index and we'll see that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1096" target="_blank">00:18:16.560</a></span> | <span class="t">we get this minus one which means that the the level is in there that the structure has not</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1102" target="_blank">00:18:22.800</a></span> | <span class="t">been initialized yet and we also see that if we we do this so this is how we get the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1109" target="_blank">00:18:29.840</a></span> | <span class="t">number of vertices that we have within each layer so we write the vice vector to array</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1120" target="_blank">00:18:40.000</a></span> | <span class="t">and in here we want to write index hsw levels and then let's print out</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1132" target="_blank">00:18:52.160</a></span> | <span class="t">and we see that we we just get this empty array now what we'd also want to do when we do so this</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1138" target="_blank">00:18:58.160</a></span> | <span class="t">is just a massive array so if we we will have a million values in here once we we add our cif-1m</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1149" target="_blank">00:19:09.040</a></span> | <span class="t">data set so what we do is we just write npb count levels to count the number to count basically how</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1158" target="_blank">00:19:18.960</a></span> | <span class="t">many vertices we have in each level when i say level by the way it's the same as earlier on when</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1165" target="_blank">00:19:25.440</a></span> | <span class="t">i was saying layers it's they're the same so when i say levels layers same thing so obviously at the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1173" target="_blank">00:19:33.840</a></span> | <span class="t">moment we don't have anything in our graph so how do we how do we add that we we already know</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1181" target="_blank">00:19:41.600</a></span> | <span class="t">we just do index add xb okay nothing else so we add that that might take some time because</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1190" target="_blank">00:19:50.560</a></span> | <span class="t">we're building the graph we saw before it's a reasonably intensive process so it does take a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1195" target="_blank">00:19:55.680</a></span> | <span class="t">little bit of time i think maybe around 40 seconds for this so i will fast forward okay so it's done</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1206" target="_blank">00:20:06.000</a></span> | <span class="t">52 seconds not too bad now what we're now going to do is i want to have a look at these again so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1214" target="_blank">00:20:14.240</a></span> | <span class="t">let's see if we we have a structure in our graph yet so max level so that's cool we have that means</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1221" target="_blank">00:20:21.440</a></span> | <span class="t">we have five levels zero one two up to four and then if we do this again we'll be able to see the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1230" target="_blank">00:20:30.320</a></span> | <span class="t">distribution of vertices across each one of those levels so i'll just write this there we go so we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1238" target="_blank">00:20:38.880</a></span> | <span class="t">just ignore this this first one here that doesn't mean anything so this is our layer zero like i</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1246" target="_blank">00:20:46.400</a></span> | <span class="t">said most vectors get assigned to this layer now we have layer one all the way up to layer four here</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1256" target="_blank">00:20:56.320</a></span> | <span class="t">or level four now vice will always add at least one vertex to your maximum level because</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1265" target="_blank">00:21:05.680</a></span> | <span class="t">otherwise we we don't have an entry point to our graph so there's always at least one in there</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1271" target="_blank">00:21:11.120</a></span> | <span class="t">and we can also check what which vector is being used there so we can write index hsw</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1280" target="_blank">00:21:20.880</a></span> | <span class="t">entry points yes and there we have said that that's the number of our vector that we have added</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1291" target="_blank">00:21:31.120</a></span> | <span class="t">as our entry point up here you can also change that if you want but i wouldn't probably especially</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1297" target="_blank">00:21:37.840</a></span> | <span class="t">with this i definitely wouldn't recommend it now i was super curious as to how it decides</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1303" target="_blank">00:21:43.920</a></span> | <span class="t">where to insert everything so went through the code which you can find over here so this is the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1312" target="_blank">00:21:52.240</a></span> | <span class="t">defy scale repo and we have this hsw cpp file and in here we come down and it might take me a little</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1322" target="_blank">00:22:02.320</a></span> | <span class="t">while so this is where we initialize our index and we have this set default probus so if we if we go</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1331" target="_blank">00:22:11.680</a></span> | <span class="t">into set default progress we will find this here which is not really too hard to read i don't</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1340" target="_blank">00:22:20.080</a></span> | <span class="t">read i don't know c++ but this is pretty simple and what i translated that to in python is this</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1348" target="_blank">00:22:28.720</a></span> | <span class="t">here with a few comments because there is no comments in the other file for some reason</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1355" target="_blank">00:22:35.360</a></span> | <span class="t">now what we're basically doing is just building a probability distribution for each of our layers</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1362" target="_blank">00:22:42.560</a></span> | <span class="t">and we do using this this function here so we're taking the exponential of the the level</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1371" target="_blank">00:22:51.280</a></span> | <span class="t">divided by at that ml function or value that i mentioned earlier so that's the the multi-level</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1379" target="_blank">00:22:59.920</a></span> | <span class="t">the level multiplier value and what we get is a probability for the current level now</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1387" target="_blank">00:23:07.840</a></span> | <span class="t">what we do is once we reach a particularly low probability we we start creating new levels</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1395" target="_blank">00:23:15.840</a></span> | <span class="t">so if we we run this oh another actually interesting thing is here we we are saying</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1405" target="_blank">00:23:25.440</a></span> | <span class="t">on every level we will assign m neighbors as our as our m max except from level zero</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1412" target="_blank">00:23:32.720</a></span> | <span class="t">where we will assign two m okay so this is this m times like two so for our use case we had 32</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1424" target="_blank">00:23:44.000</a></span> | <span class="t">we had m set to 32 so that means in all of our layers except from layer zero we'll have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1430" target="_blank">00:23:50.480</a></span> | <span class="t">each vertex will have 32 neighbors or friends and on layer or level zero it will have 64</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1439" target="_blank">00:23:59.760</a></span> | <span class="t">friends so i thought that was that was also interesting so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1443" target="_blank">00:24:03.440</a></span> | <span class="t">we can go ahead and run that so i'm the 32 here is our m we can replace it m if you if we want</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1453" target="_blank">00:24:13.600</a></span> | <span class="t">so we run that and we get this probability distribution so this is for layer zero the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1459" target="_blank">00:24:19.520</a></span> | <span class="t">probability of it being added using a random number generator so we're saying if our randomly</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1466" target="_blank">00:24:26.160</a></span> | <span class="t">generated number is less than this value we will assign or we will insert our vertex on at level</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1475" target="_blank">00:24:35.600</a></span> | <span class="t">zero and then we continue that logic all the way down to here which is our level four and then here</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1483" target="_blank">00:24:43.600</a></span> | <span class="t">is the total number so the cumulative number of neighbors per level so if we insert at level four</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1490" target="_blank">00:24:50.400</a></span> | <span class="t">we we will have this many neighbors for that vertex in total if we insert level zero we have 64 again</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1498" target="_blank">00:24:58.320</a></span> | <span class="t">a little bit interesting now in the in the code we when we're inserting vertices we use another</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1507" target="_blank">00:25:07.200</a></span> | <span class="t">function this is the last one we're not going to go through all of them we're just going to go</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1510" target="_blank">00:25:10.800</a></span> | <span class="t">through this one we insert or we decide where to insert our vertex using this function here which</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1517" target="_blank">00:25:17.040</a></span> | <span class="t">is the random level function this takes our sign probus from up here so this here and also a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1525" target="_blank">00:25:25.840</a></span> | <span class="t">randomly generated number so here i'm using the numpy's random number generator</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1533" target="_blank">00:25:33.840</a></span> | <span class="t">and we go through and that's that's how we assign a different level for each of our values so if i</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1542" target="_blank">00:25:42.000</a></span> | <span class="t">let's run that and we'll see that we get a very similar distribution to to what we get in vice</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1552" target="_blank">00:25:52.240</a></span> | <span class="t">which i is i think pretty cool to see so if we do the bin count again we get this now if you take a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1561" target="_blank">00:26:01.760</a></span> | <span class="t">look at this these values are so close to to what we produce up here so where is it um so here look</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1572" target="_blank">00:26:12.720</a></span> | <span class="t">at these values almost exactly the same so yeah it's pretty close they're both working in the same</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1583" target="_blank">00:26:23.520</a></span> | <span class="t">way now i also visualize that in in this chart here so you can you can see okay on the right</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1593" target="_blank">00:26:33.280</a></span> | <span class="t">we have a python version on the left we have our vice version and i've included the numbers in there</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1598" target="_blank">00:26:38.720</a></span> | <span class="t">basically that is exactly it's pretty much exactly the same it's off by a few here and there but not</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1605" target="_blank">00:26:45.280</a></span> | <span class="t">much so i thought that was pretty cool to see now okay that's cool that's how everything works</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1613" target="_blank">00:26:53.280</a></span> | <span class="t">that's interesting but what i think many of us are probably most interested in is how do i build the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1622" target="_blank">00:27:02.400</a></span> | <span class="t">best hs sub u index for my for my use case for what i want so i ran some codes to go through</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1632" target="_blank">00:27:12.240</a></span> | <span class="t">all of that and pretty much i did this so we have this is also a good thing for me to show you um</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1642" target="_blank">00:27:22.960</a></span> | <span class="t">is how we get out ef construction and ef search values so i think you know a good starting point</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1649" target="_blank">00:27:29.760</a></span> | <span class="t">for both of these values is probably 16 32 is reasonable but you can play around them i think</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1660" target="_blank">00:27:40.800</a></span> | <span class="t">that's usually the best way and for most of what i'm going to show you i was using this so i was</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1667" target="_blank">00:27:47.600</a></span> | <span class="t">performing a thousand queries and calculating the recall at one value for those also i was</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1677" target="_blank">00:27:57.040</a></span> | <span class="t">checking you know how long our search is taking and the memory usage of each of these indexes</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1682" target="_blank">00:28:02.960</a></span> | <span class="t">so the first thing i wanted to look at is a recall of course so in in what what we have here</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1693" target="_blank">00:28:13.840</a></span> | <span class="t">on the left we have with a ef constriction value of two which is is very low i person i</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1701" target="_blank">00:28:21.200</a></span> | <span class="t">i don't know never use that never use an ef constriction value that low it well well you</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1708" target="_blank">00:28:28.000</a></span> | <span class="t">can see the recall is pretty terrible but you know surprisingly even though this is a very bad</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1713" target="_blank">00:28:33.200</a></span> | <span class="t">ef constriction value still got up to 40 percent recall so i was impressed with that that was cool</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1722" target="_blank">00:28:42.240</a></span> | <span class="t">and so the ef search values are what you can see on the bottom so it went from from i think two all</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1728" target="_blank">00:28:48.320</a></span> | <span class="t">the way up to 256 256 yeah that's right and we did that again for the ef constriction value of 16 here</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1739" target="_blank">00:28:59.200</a></span> | <span class="t">and also 64 i did it for more ef constriction values but these are probably the ones i think</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1745" target="_blank">00:29:05.440</a></span> | <span class="t">showed the relationship best and then all the colors you can see here we have a few different</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1750" target="_blank">00:29:10.560</a></span> | <span class="t">colors we're using different m values so what i found from this is that you basically you want</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1759" target="_blank">00:29:19.760</a></span> | <span class="t">to increase your your m and your ef search values to improve your recall and ef construction also</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1766" target="_blank">00:29:26.960</a></span> | <span class="t">helps with that so higher ef constriction value means that we need lower ef search and m values</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1773" target="_blank">00:29:33.440</a></span> | <span class="t">to achieve you know the same the same recall now of course you know we can just increase all of</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1780" target="_blank">00:29:40.960</a></span> | <span class="t">these and we we get better recall but that isn't for free we have to sacrifice some of our search</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1790" target="_blank">00:29:50.560</a></span> | <span class="t">time as well as always so we well this is this is what we've got so same same graphs as last time</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1801" target="_blank">00:30:01.040</a></span> | <span class="t">this time we have search time on the y-axis now ef construction here</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1807" target="_blank">00:30:07.760</a></span> | <span class="t">does actually make a bit of a difference when we start using higher m values so i found before in</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1818" target="_blank">00:30:18.000</a></span> | <span class="t">previous videos and articles that ef construction didn't really have too much of an effect</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1823" target="_blank">00:30:23.200</a></span> | <span class="t">on the search time which seemed fair enough because it is mostly a index construction</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1831" target="_blank">00:30:31.120</a></span> | <span class="t">parameter but that it does seem to have some effect when you start adding or increasing</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1838" target="_blank">00:30:38.000</a></span> | <span class="t">the number of queries that you are searching for and in particular where you have high m values</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1845" target="_blank">00:30:45.040</a></span> | <span class="t">now one thing to also note here is that we're using a load scale on the y-axis so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1852" target="_blank">00:30:52.000</a></span> | <span class="t">the the higher values are definitely a fair bit higher but again i mean if we if we go for a sort</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1859" target="_blank">00:30:59.280</a></span> | <span class="t">of reasonable ef search value all of these are pretty high i mean 256 for your search values</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1865" target="_blank">00:31:05.840</a></span> | <span class="t">is high if we go for sort of es search of 32 let's say around here</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1878" target="_blank">00:31:18.800</a></span> | <span class="t">we're still getting reasonable search times so this is on the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1881" target="_blank">00:31:21.920</a></span> | <span class="t">millisecond well it's a bit more than a millisecond scale</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1885" target="_blank">00:31:25.840</a></span> | <span class="t">and if we if we take a look at that on uh recall we're sort of getting up into the sort of 60</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1898" target="_blank">00:31:38.320</a></span> | <span class="t">60 plus area at that point six cent plus and and look obviously it's not bad it's reasonably good</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1908" target="_blank">00:31:48.400</a></span> | <span class="t">but you can you can definitely get better than that when you start merging different</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1912" target="_blank">00:31:52.720</a></span> | <span class="t">indexes which we have covered all of that in another video another article so you'll be</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1921" target="_blank">00:32:01.120</a></span> | <span class="t">able to find that in in the either at the bottom of the article if you're reading the article</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1925" target="_blank">00:32:05.600</a></span> | <span class="t">or in the the video description if you're watching us on youtube</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1928" target="_blank">00:32:08.960</a></span> | <span class="t">now having a look at the the ef construction values again their effect on the search time</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1936" target="_blank">00:32:16.720</a></span> | <span class="t">we find that ef construction when we use those lower end values like i mentioned it doesn't</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1942" target="_blank">00:32:22.720</a></span> | <span class="t">have too much of a impact on the search time so if you are using a lower m value i think ef</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1949" target="_blank">00:32:29.520</a></span> | <span class="t">construction is a a good value to increase because it doesn't tend to make push up your search time</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1957" target="_blank">00:32:37.680</a></span> | <span class="t">too much and you can improve your recall fair bit by increasing it so it's definitely one to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1966" target="_blank">00:32:46.080</a></span> | <span class="t">one to try and increase them and see how it goes for me i found it it's been quite useful at least</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1972" target="_blank">00:32:52.000</a></span> | <span class="t">and then finally the sort of negative point of h and sub u is the memory usage is just</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1980" target="_blank">00:33:00.640</a></span> | <span class="t">through the roof as you can see here so using the lowest m value which i think was</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1986" target="_blank">00:33:06.160</a></span> | <span class="t">two which is you you would never ever use that we were getting a memory usage for the sift 1m</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=1993" target="_blank">00:33:13.120</a></span> | <span class="t">data set of more than more than half a gigabyte if you push m up a lot i mean 500 and 512 is is</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2003" target="_blank">00:33:23.600</a></span> | <span class="t">maybe a little bit too much but we're sort of pushing four and a half gigabytes five gigabytes</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2009" target="_blank">00:33:29.680</a></span> | <span class="t">so it's something to be aware of i think but like i said before we can we can still improve the the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2019" target="_blank">00:33:39.840</a></span> | <span class="t">memory usage and the search speed by simply using different indexes alongside our hsw index so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2027" target="_blank">00:33:47.760</a></span> | <span class="t">if memory usage is a concern you just compress the vectors using product quantization</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2032" target="_blank">00:33:52.960</a></span> | <span class="t">if the speed if you need it to be even faster you can use the an ibf index on top of hsw to improve</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2045" target="_blank">00:34:05.120</a></span> | <span class="t">the search times and if you want both of those you just put them all together and you can get</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2051" target="_blank">00:34:11.280</a></span> | <span class="t">that as well now like i said we we have covered all that in a lot more detail in another article</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2058" target="_blank">00:34:18.160</a></span> | <span class="t">and video but for this video on hsw i think now we're gonna leave it there i think we've covered</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=QvKMwLjdK-s&t=2068" target="_blank">00:34:28.160</a></span> | <span class="t">plenty so thank you very much for watching and i'll see you in the next one bye</span></div></div></body></html>