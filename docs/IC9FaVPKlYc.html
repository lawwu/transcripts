<html><head><title>Training BERT #5 - Training With BertForPretraining</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        color: #333;
    }
    .container {
        width: 80%;
        margin: auto;
        overflow: hidden;
    }
    h2, h3 {
        color: #333;
        text-align: center;
    }
    a {
        color: #0000FF;  /* Traditional blue color for links */
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    img {
        display: block;
        margin: auto;
        max-width: 100%;
    }
    .c {
        margin: 10px 0;
    }
    .s, .t {
        display: inline-block;
        margin-right: 5px;
    }
    .max-width {
        max-width: 800px;
        margin: auto;
        padding-left: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tr:nth-child(odd) {
        background-color: #e6e6e6;
    }
</style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-69VLBMTTP0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-69VLBMTTP0');
    </script>
    </head><body><div class='container'><a href="index.html">back to index</a><h2>Training BERT #5 - Training With BertForPretraining</h2><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc"><img src="https://i.ytimg.com/vi_webp/IC9FaVPKlYc/maxresdefault.webp" style="width:50%;"></a><div><br></div><h3>Chapters</h3><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=0">0:0</a> Introduction<br><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=67">1:7</a> Import Data<br><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=202">3:22</a> Power Data<br><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=314">5:14</a> Training Data<br><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=645">10:45</a> Mask Data<br><br><div style="text-align: left;"><a href="./IC9FaVPKlYc.html">Whisper Transcript</a> | <a href="./transcript_IC9FaVPKlYc.html">Transcript Only Page</a></div><br><div style="max-width: 800px;"><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=0" target="_blank">00:00:00.000</a></span> | <span class="t">Hi, welcome to the video. Here we're going to have a look at how we can pre-train BERT.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=6" target="_blank">00:00:06.800</a></span> | <span class="t">So what I mean by pre-train is fine-tune BERT using the same approaches that are used to actually</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=14" target="_blank">00:00:14.560</a></span> | <span class="t">pre-train BERT itself. So we would use these when we want to teach BERT to better understand</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=22" target="_blank">00:00:22.400</a></span> | <span class="t">the style of language in our specific use cases. So we'll jump straight into it but what we're</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=31" target="_blank">00:00:31.920</a></span> | <span class="t">going to see is essentially two different methods applied together. So when we're pre-training we're</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=39" target="_blank">00:00:39.840</a></span> | <span class="t">using something called mass language modeling or MLM and also next sentence prediction or NSP.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=47" target="_blank">00:00:47.120</a></span> | <span class="t">Now in a few previous videos I've covered all of these so if you do want to go into a little more</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=53" target="_blank">00:00:53.280</a></span> | <span class="t">depth then I would definitely recommend having a look at those. But in this video we're just</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=58" target="_blank">00:00:58.640</a></span> | <span class="t">going to go straight into actually training a BERT model using both of those methods using</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=64" target="_blank">00:01:04.640</a></span> | <span class="t">the pre-training class. So we need first to import everything that we need. So I'm going to import</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=72" target="_blank">00:01:12.880</a></span> | <span class="t">requests because I'm going to use request download data we're using which is from here. You'll find a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=78" target="_blank">00:01:18.320</a></span> | <span class="t">link in the description for that. And we also need to import our tokenizer and model classes</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=88" target="_blank">00:01:28.080</a></span> | <span class="t">from transformers. So from transformers we're going to import BERT tokenizer</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=93" target="_blank">00:01:33.680</a></span> | <span class="t">and also BERT for pre-training.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=102" target="_blank">00:01:42.720</a></span> | <span class="t">Now like I said before this BERT for pre-training class contains both</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=107" target="_blank">00:01:47.040</a></span> | <span class="t">an MLM head and an NSP head. So once we have that we also need to import torch as well so let me</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=116" target="_blank">00:01:56.320</a></span> | <span class="t">import torch. Once we have that we can initialize our tokenizer and model. So we initialize our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=126" target="_blank">00:02:06.080</a></span> | <span class="t">tokenizer like this so BERT tokenizer and it's from pre-train and we're going to be using the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=134" target="_blank">00:02:14.320</a></span> | <span class="t">BERT base uncased model. Obviously you can use whichever BERT model you you'd like.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=142" target="_blank">00:02:22.000</a></span> | <span class="t">And for our model we have the BERT for pre-training class. So that's our tokenizer model now let's get</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=154" target="_blank">00:02:34.400</a></span> | <span class="t">our data. Don't need to worry about that warning it's just telling us that we need to train it</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=160" target="_blank">00:02:40.240</a></span> | <span class="t">basically if we want to use it for inference predictions. So we get our data we're going to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=169" target="_blank">00:02:49.360</a></span> | <span class="t">pull it from here so let me copy that and it's just request.get and paste that in there and we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=180" target="_blank">00:03:00.640</a></span> | <span class="t">should see a 200 code that's good. And so we just extract the data using the text attribute.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=187" target="_blank">00:03:07.440</a></span> | <span class="t">So text is that we also need to split it because it's a set of paragraphs that are split by a new</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=195" target="_blank">00:03:15.600</a></span> | <span class="t">line character and we can see those in here. Now we need to pair our data both for NSP and MLM so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=206" target="_blank">00:03:26.160</a></span> | <span class="t">we'll go with NSP first and to do that we need to create a set of random sentences. So sentence A</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=214" target="_blank">00:03:34.080</a></span> | <span class="t">and B where the sentence B is not related to sentence A. We need roughly 50 percent of those</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=222" target="_blank">00:03:42.320</a></span> | <span class="t">and then the other 50 percent we want it to be sentence A is followed by sentence B so they are</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=229" target="_blank">00:03:49.520</a></span> | <span class="t">more coherent. So we're basically teaching BERT to distinguish between coherence and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=235" target="_blank">00:03:55.360</a></span> | <span class="t">non-coherence between sentences so like long-term dependencies.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=240" target="_blank">00:04:00.320</a></span> | <span class="t">And we just want to be aware that within our text so we have this one paragraph that has</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=249" target="_blank">00:04:09.520</a></span> | <span class="t">multiple sentences so if we split by this we have those. So we need to create essentially a list of</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=258" target="_blank">00:04:18.960</a></span> | <span class="t">all of the different sentences that we have that we can just pull from when we're creating our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=263" target="_blank">00:04:23.200</a></span> | <span class="t">training data for NSP. Now to do that we're going to use this comprehension here and what we do is</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=271" target="_blank">00:04:31.360</a></span> | <span class="t">write sentence so for each sentence for each paragraph in the text so this variable</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=282" target="_blank">00:04:42.560</a></span> | <span class="t">for sentence in para.split so this is where we're getting our sentence variable from</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=288" target="_blank">00:04:48.880</a></span> | <span class="t">and we just want to be aware of if we have a look at this one we see we get this this empty</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=297" target="_blank">00:04:57.120</a></span> | <span class="t">sentence we get that for all of our paragraphs so we just want to not include those so we say if</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=302" target="_blank">00:05:02.080</a></span> | <span class="t">sentence is not equal to that empty sentence and we're also going to need to get the length of that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=312" target="_blank">00:05:12.000</a></span> | <span class="t">bag for later as well and now what we do is create our NSP training data so we want that 50/50 split</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=320" target="_blank">00:05:20.720</a></span> | <span class="t">so we're going to use the random library to create that 50/50 randomness we want to initialize a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=330" target="_blank">00:05:30.640</a></span> | <span class="t">list of sentence A's a list of sentence B's and also a list of labels and then what we do is we're</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=341" target="_blank">00:05:41.440</a></span> | <span class="t">going to loop through each paragraph in our text so for paragraph in text we want to extract each</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=350" target="_blank">00:05:50.560</a></span> | <span class="t">sentence from the paragraph so we're going to use it similar to what we've done here so write</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=355" target="_blank">00:05:55.680</a></span> | <span class="t">sentences and this is going to be a list of all the sentences within each paragraph so sentence</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=361" target="_blank">00:06:01.360</a></span> | <span class="t">for sentence in paragraph dot split by a period character and we also want to make sure we're not</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=371" target="_blank">00:06:11.840</a></span> | <span class="t">including those empty ones so if sentence is not equal to empty then once we're there what we want</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=382" target="_blank">00:06:22.800</a></span> | <span class="t">to do is want to get the number of sentences within each sentence or sentences variable so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=392" target="_blank">00:06:32.560</a></span> | <span class="t">just get length and the reason we do that is because we want to check that a couple of times</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=397" target="_blank">00:06:37.680</a></span> | <span class="t">in the next few lines of code and first time we check that is now so we check that the number of</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=404" target="_blank">00:06:44.320</a></span> | <span class="t">sentences is greater than one now this because we're concatenating two sentences to create our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=412" target="_blank">00:06:52.000</a></span> | <span class="t">training data we don't want to get just one sentence we need it where we have for example</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=417" target="_blank">00:06:57.280</a></span> | <span class="t">in this one where multiple sentences so that we can select like this sentence followed by this</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=422" target="_blank">00:07:02.320</a></span> | <span class="t">sentence we can't do that with these because there's no guarantee that this paragraph here</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=427" target="_blank">00:07:07.680</a></span> | <span class="t">is going to be talking about the same topic as this paragraph here so we just avoid that and</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=432" target="_blank">00:07:12.640</a></span> | <span class="t">in here first thing we want to do is set our start sentence so this is where sentence a is going to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=439" target="_blank">00:07:19.280</a></span> | <span class="t">come from and we're going to randomly select say for this example we want to randomly select</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=445" target="_blank">00:07:25.840</a></span> | <span class="t">any of the first one two three sentences okay we'd want to select any of these three</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=454" target="_blank">00:07:34.000</a></span> | <span class="t">but not this one because if this sentence a we don't have a sentence b which follows it to extract</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=462" target="_blank">00:07:42.240</a></span> | <span class="t">so we write random rand int zero up to the length of num sentences</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=469" target="_blank">00:07:49.200</a></span> | <span class="t">minus two now we can now get our sentence a which is append and we just write sentences</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=480" target="_blank">00:08:00.000</a></span> | <span class="t">start and then for our sentence b 50% we want to select a random one from bag</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=489" target="_blank">00:08:09.040</a></span> | <span class="t">up here 50% of the time we want to select the genuine next sentence so say if random</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=495" target="_blank">00:08:15.280</a></span> | <span class="t">dot random so this will select a random float between zero and one is greater than 0.5</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=501" target="_blank">00:08:21.680</a></span> | <span class="t">and sentence b</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=504" target="_blank">00:08:24.480</a></span> | <span class="t">is going to be we'll make this our coherent version so sentences</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=515" target="_blank">00:08:35.440</a></span> | <span class="t">start plus one and that means our label will have to be zero because that means</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=524" target="_blank">00:08:44.320</a></span> | <span class="t">that these two sentences are coherent sentence b does follow sentence a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=528" target="_blank">00:08:48.800</a></span> | <span class="t">otherwise we select a random sentence for sentence b so do append and here we would write bag</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=540" target="_blank">00:09:00.880</a></span> | <span class="t">and we need to need to select a random one so we do random same as we did earlier on for the start</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=546" target="_blank">00:09:06.240</a></span> | <span class="t">we do random rand int from zero to the length of the bag size minus one so now we also need</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=556" target="_blank">00:09:16.960</a></span> | <span class="t">to do the label which is going to be one in this case we can execute that now that will work i go</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=564" target="_blank">00:09:24.640</a></span> | <span class="t">a little more into depth on this in the previous nsp video so i'll leave a link to that in the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=572" target="_blank">00:09:32.000</a></span> | <span class="t">description if you want to go through it and now what we can do is tokenize our data</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=577" target="_blank">00:09:37.040</a></span> | <span class="t">so to do that we just write inputs and we use a tokenizer so this is just normal you know</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=583" target="_blank">00:09:43.840</a></span> | <span class="t">hugging face transformers and we just write sentence a and sentence b so hugging face</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=593" target="_blank">00:09:53.440</a></span> | <span class="t">transformers will will know what we want to do that would deal with formatting for us which is</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=598" target="_blank">00:09:58.000</a></span> | <span class="t">pretty useful we want to return pytorch tensors so return tensors equals pt and we need to set</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=611" target="_blank">00:10:11.200</a></span> | <span class="t">everything to a max length of 512 tokens so max length equals 512 the truncation needs to be set</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=622" target="_blank">00:10:22.400</a></span> | <span class="t">to true and we also need to set padding equal to max length okay</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=629" target="_blank">00:10:29.280</a></span> | <span class="t">so that creates three different tensors for us</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=636" target="_blank">00:10:36.560</a></span> | <span class="t">input ids token type ids and attention mask now for the pre-train model we need two more tensors</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=646" target="_blank">00:10:46.560</a></span> | <span class="t">we need our next sentence label tensor so to create that we write inputs next sentence</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=654" target="_blank">00:10:54.560</a></span> | <span class="t">label and that needs to be a long tensor</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=659" target="_blank">00:10:59.840</a></span> | <span class="t">containing our labels which we created before in the correct dimensionality so that's why we're</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=670" target="_blank">00:11:10.080</a></span> | <span class="t">using the the list here and the transpose and we can have a look at what that creates as well</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=677" target="_blank">00:11:17.120</a></span> | <span class="t">so let's have a look at the first 10 we get that okay and now what we want to do is create our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=685" target="_blank">00:11:25.440</a></span> | <span class="t">mask data so we need the labels for our mask first so when we do this what we'll do is we're going to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=694" target="_blank">00:11:34.640</a></span> | <span class="t">clone the input ids tensor we're going to use that clone for the labels tensor and then we're going</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=700" target="_blank">00:11:40.800</a></span> | <span class="t">to go back to our input ids and mask around 15 of the tokens in that tensor so let's create that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=707" target="_blank">00:11:47.360</a></span> | <span class="t">labels tensor it's going to be equal to inputs input ids detach and clone okay so now we'll see</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=723" target="_blank">00:12:03.360</a></span> | <span class="t">in here we have all of the tensors we need but we still need to mask around 15 of these before</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=729" target="_blank">00:12:09.120</a></span> | <span class="t">moving on to training our model and to do that we'll use we'll create a random array</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=734" target="_blank">00:12:14.720</a></span> | <span class="t">using the torch rand that needs to be in the same shape as our input ids</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=740" target="_blank">00:12:20.560</a></span> | <span class="t">and that will just create a big tensor between values of zero up to one and what we want to do</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=749" target="_blank">00:12:29.840</a></span> | <span class="t">is mask around 15 of those so we will write something like this okay and that will give us</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=757" target="_blank">00:12:37.920</a></span> | <span class="t">our mask here but we also don't want to mask special tokens which we are doing here we're</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=763" target="_blank">00:12:43.840</a></span> | <span class="t">masking our classification tokens and we're also masking padding tokens up here so we need to add</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=769" target="_blank">00:12:49.680</a></span> | <span class="t">a little bit more logic to that so let me just add this to a variable so we add that logic</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=780" target="_blank">00:13:00.000</a></span> | <span class="t">which says</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=780" target="_blank">00:13:00.720</a></span> | <span class="t">and input ids is not equal to 101 which is our cls token which is what we</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=792" target="_blank">00:13:12.800</a></span> | <span class="t">we get down here so we can actually see the impact see we get faults now</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=797" target="_blank">00:13:17.360</a></span> | <span class="t">and we also want to do the same file separator tokens</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=805" target="_blank">00:13:25.040</a></span> | <span class="t">which is 102 we can't see any of those and our padding tokens we use zero</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=810" target="_blank">00:13:30.560</a></span> | <span class="t">so you see these are all that will go false now like so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=816" target="_blank">00:13:36.560</a></span> | <span class="t">so that's our masking array and now what we want to do is loop through all of these extract</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=827" target="_blank">00:13:47.120</a></span> | <span class="t">the points at which they are not false so where we have the mask and use those indice values</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=836" target="_blank">00:13:56.400</a></span> | <span class="t">to mask our actual input ids up here to do that we go for i in range inputs input ids dot shape</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=848" target="_blank">00:14:08.880</a></span> | <span class="t">zero this is like iterating through each row and what we do here is we get selection</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=858" target="_blank">00:14:18.720</a></span> | <span class="t">so these are the indices where we have true values from the mask array</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=862" target="_blank">00:14:22.880</a></span> | <span class="t">and we do that using torch flatten mask array</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=872" target="_blank">00:14:32.320</a></span> | <span class="t">at the given index where they are non-zero and we want to create a list from that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=880" target="_blank">00:14:40.160</a></span> | <span class="t">okay so we have that um oh and so let me show you what the selection looks like quickly</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=887" target="_blank">00:14:47.920</a></span> | <span class="t">so it's just a selection of indices to mask and we want to apply that to our inputs</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=898" target="_blank">00:14:58.160</a></span> | <span class="t">input ids so at the current index and we select those specific items and we set them equal to 103</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=909" target="_blank">00:15:09.760</a></span> | <span class="t">which is the masking token id okay so that's our masking and now what we need to do is we need to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=920" target="_blank">00:15:20.160</a></span> | <span class="t">take all of our data here and load it into a pytorch data loader and to do that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=927" target="_blank">00:15:27.200</a></span> | <span class="t">we need to reformat our data into a pytorch data set object and we do that here so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=934" target="_blank">00:15:34.160</a></span> | <span class="t">main thing to note is we pass our data into this initialization that assigns them to this self</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=942" target="_blank">00:15:42.080</a></span> | <span class="t">encodings attribute and then here we say okay given a certain index we want to extract the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=949" target="_blank">00:15:49.760</a></span> | <span class="t">tensors in a dictionary format for that index and then here we're just passing</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=957" target="_blank">00:15:57.040</a></span> | <span class="t">lengths to how many uh how many tensors or how many samples we have in the full data set</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=962" target="_blank">00:16:02.720</a></span> | <span class="t">so run that we initialize our data set using that class so right data set equals</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=972" target="_blank">00:16:12.320</a></span> | <span class="t">meditations data set pass our data in there which is inputs and then with that we can create our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=979" target="_blank">00:16:19.600</a></span> | <span class="t">data loader like this so torch utils data data loader and we have data set</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=989" target="_blank">00:16:29.280</a></span> | <span class="t">okay so that's ready now we need to set up our training loop so first thing we need to do is</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=998" target="_blank">00:16:38.400</a></span> | <span class="t">check if we are on gpu or not if we are we use it and we do that like so so device equals torch</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1005" target="_blank">00:16:45.040</a></span> | <span class="t">device cuda if torch cuda is available else torch device cpu so that's saying use the gpu if we have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1012" target="_blank">00:16:52.000</a></span> | <span class="t">the cuda enabled gpu otherwise use cpu and then what we want to do is move our model over to that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1021" target="_blank">00:17:01.040</a></span> | <span class="t">device and we also want to activate the training mode of our model</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1029" target="_blank">00:17:09.040</a></span> | <span class="t">and then we need to initialize our optimizer i'm going to be using adam with weighted decay</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1037" target="_blank">00:17:17.040</a></span> | <span class="t">so from transformers import adam w and initialize it like this so optim equals adam w</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1050" target="_blank">00:17:30.480</a></span> | <span class="t">we pass our model parameters to that and we also pass a learning rate so learning rate</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1056" target="_blank">00:17:36.960</a></span> | <span class="t">is going to be 5e to the minus 5 okay and now we can create our training loop so</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1065" target="_blank">00:17:45.040</a></span> | <span class="t">you're going to use tqdm to create the the progress bar and we're going to go through</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1073" target="_blank">00:17:53.280</a></span> | <span class="t">two epochs so for epoch in range 2 we initialize our loop by wrapping it within tqdm and in here</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1084" target="_blank">00:18:04.480</a></span> | <span class="t">we have our data loader and we set leave equal to true so that we can see that progress bar</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1090" target="_blank">00:18:10.480</a></span> | <span class="t">and then we loop through each batch within that loop</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1099" target="_blank">00:18:19.440</a></span> | <span class="t">um oh up here so i didn't actually set the batches my mistake so up here we want to set</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1105" target="_blank">00:18:25.440</a></span> | <span class="t">where we initialize the data loader i'm going to set batch batch size</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1109" target="_blank">00:18:29.680</a></span> | <span class="t">equal to 16 and also shuffle the data set as well</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1114" target="_blank">00:18:34.720</a></span> | <span class="t">okay so for batch in loop here we want to initialize the gradients on our optimizer</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1127" target="_blank">00:18:47.920</a></span> | <span class="t">and then we need to load in each of our tensors which there are quite a few of them so we have</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1134" target="_blank">00:18:54.320</a></span> | <span class="t">input keys we need to load in each one of these so input ids equals batch we access this like a</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1146" target="_blank">00:19:06.000</a></span> | <span class="t">dictionary so input ids we also want to move each one of those tensors that we're using to our device</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1156" target="_blank">00:19:16.400</a></span> | <span class="t">so we do that for each one of those</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1163" target="_blank">00:19:23.120</a></span> | <span class="t">and we have tension mask and next sentence labels and also labels</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1181" target="_blank">00:19:41.040</a></span> | <span class="t">okay and now we can actually process that through our model</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1187" target="_blank">00:19:47.200</a></span> | <span class="t">so in here we just need to pass all of these tensors that we have so input ids</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1193" target="_blank">00:19:53.440</a></span> | <span class="t">then we have token type ids just copy this</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1199" target="_blank">00:19:59.600</a></span> | <span class="t">attention mass</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1210" target="_blank">00:20:10.240</a></span> | <span class="t">next sentence label</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1211" target="_blank">00:20:11.840</a></span> | <span class="t">and labels</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1217" target="_blank">00:20:17.200</a></span> | <span class="t">okay so there's quite a lot going into our model and now what we want to do is extract the loss</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1227" target="_blank">00:20:27.200</a></span> | <span class="t">from that then we calculate loss for every parameter in our model and then using that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1235" target="_blank">00:20:35.280</a></span> | <span class="t">we can update our gradients using our optimizer and then what we want to do is print the relevant</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1242" target="_blank">00:20:42.720</a></span> | <span class="t">info to our progress bar that we set up using tqdm and loop so loop with set description</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1251" target="_blank">00:20:51.840</a></span> | <span class="t">and here I was going to put the epoch info so the epoch we're currently on</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1262" target="_blank">00:21:02.880</a></span> | <span class="t">and then I also want to set the postfix</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1265" target="_blank">00:21:05.440</a></span> | <span class="t">which will contain the loss information so loss.item okay we can run that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1275" target="_blank">00:21:15.600</a></span> | <span class="t">and you see that our model is now training so we're now training a model using both our</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1283" target="_blank">00:21:23.760</a></span> | <span class="t">sign language modeling and next sentence prediction and we haven't needed to take any</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1289" target="_blank">00:21:29.600</a></span> | <span class="t">structured data we've just taken a book and pulled all data and formatted it in the correct</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1295" target="_blank">00:21:35.520</a></span> | <span class="t">way for us to actually train a better model which I think is really cool so that's it</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=IC9FaVPKlYc&t=1300" target="_blank">00:21:40.720</a></span> | <span class="t">for this video I hope it's been useful and I'll see you in the next one.</span></div></div></body></html>