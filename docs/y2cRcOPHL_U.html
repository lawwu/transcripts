<html><head><title>Streaming for LangChain Agents + FastAPI</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        color: #333;
    }
    .container {
        width: 95%;  /* Increased width to use more space */
        margin: auto;
        overflow: auto;  /* Added to handle overflow by adding a scrollbar if necessary */
    }
    h2, h3 {
        color: #333;
        text-align: center;
    }
    a {
        color: #0000FF;  /* Traditional blue color for links */
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    img {
        display: block;
        margin: auto;
        max-width: 100%;
    }
    .c {
        margin: 10px 0;
    }
    .s, .t {
        display: inline-block;
        margin-right: 5px;
    }
    .max-width {
        max-width: 800px;
        margin: auto;
        padding-left: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;  /* Ensure text alignment is consistent */
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tr:nth-child(odd) {
        background-color: #e6e6e6;
    }
</style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-69VLBMTTP0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-69VLBMTTP0');
    </script>
    </head><body><div class='container'><a href="index.html">back to index</a><h2>Streaming for LangChain Agents + FastAPI</h2><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U"><img src="https://i.ytimg.com/vi/y2cRcOPHL_U/maxresdefault.jpg" style="width:50%;"></a><div><br></div><h3>Chapters</h3><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=0">0:0</a> Streaming for LLMs and Agents<br><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=98">1:38</a> Simple StdOut Streaming in LangChain<br><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=303">5:3</a> Streaming with LangChain Agents<br><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=476">7:56</a> Final Output Streaming<br><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=602">10:2</a> Custom Callback Handlers in LangChain<br><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=856">14:16</a> FastAPI with LangChain Agent Streaming<br><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1376">22:56</a> Confirming we have Agent Streaming<br><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1472">24:32</a> Custom Callback Handlers for Async<br><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1586">26:26</a> Final Things to Consider<br><br><div style="text-align: left;"><a href="./y2cRcOPHL_U.html">Whisper Transcript</a> | <a href="./transcript_y2cRcOPHL_U.html">Transcript Only Page</a></div><br><div style="max-width: 800px;"><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=0" target="_blank">00:00:00.000</a></span> | <span class="t">Today we're going to learn how to do streaming with LangChain.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=4" target="_blank">00:00:04.000</a></span> | <span class="t">Now streaming is a very popular feature for large language models and chatbots,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=9" target="_blank">00:00:09.120</a></span> | <span class="t">but it can be quite complicated to implement or at least confusing to get started with.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=16" target="_blank">00:00:16.000</a></span> | <span class="t">Now for those of you that are maybe not aware of streaming,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=18" target="_blank">00:00:18.880</a></span> | <span class="t">it's essentially when you are talking to an LLM or a chatbot</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=22" target="_blank">00:00:22.320</a></span> | <span class="t">and it is loading the output token by token or word by word.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=28" target="_blank">00:00:28.480</a></span> | <span class="t">Now the whole point of using streaming in the first place is that,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=32" target="_blank">00:00:32.080</a></span> | <span class="t">particularly if you're generating a lot of text,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=35" target="_blank">00:00:35.280</a></span> | <span class="t">you can begin showing the user that text and they can begin reading sooner.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=41" target="_blank">00:00:41.520</a></span> | <span class="t">Now implementing streaming, it can be very simple</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=46" target="_blank">00:00:46.400</a></span> | <span class="t">if you are implementing it for a simple use case,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=49" target="_blank">00:00:49.600</a></span> | <span class="t">but it begins to get more difficult first when you start using LangChain</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=54" target="_blank">00:00:54.240</a></span> | <span class="t">and then secondly if we begin using agents it gets a little more complicated.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=59" target="_blank">00:00:59.520</a></span> | <span class="t">Then if we take it a little further and maybe we want to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=62" target="_blank">00:01:02.560</a></span> | <span class="t">stream the data from our agent through to our own API,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=67" target="_blank">00:01:07.360</a></span> | <span class="t">then again things get a little more complicated.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=71" target="_blank">00:01:11.360</a></span> | <span class="t">But in this video we're going to go through all of that,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=73" target="_blank">00:01:13.360</a></span> | <span class="t">so by the end of this we'll actually have an agent in LangChain</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=77" target="_blank">00:01:17.360</a></span> | <span class="t">that is streaming via a FastAPI instance.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=80" target="_blank">00:01:20.960</a></span> | <span class="t">So let's just jump straight into it.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=84" target="_blank">00:01:24.400</a></span> | <span class="t">Now the simplest form of streaming that we can do is</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=87" target="_blank">00:01:27.680</a></span> | <span class="t">basically just printing out to the terminal or as you'll see in a Jupyter notebook.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=93" target="_blank">00:01:33.120</a></span> | <span class="t">To achieve that level of streaming it's very easy.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=96" target="_blank">00:01:36.400</a></span> | <span class="t">Let's take a look at how we would do it.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=98" target="_blank">00:01:38.240</a></span> | <span class="t">So we use these two parameters when we're initializing our LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=102" target="_blank">00:01:42.880</a></span> | <span class="t">So here it's just a chatOpenAI object.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=108" target="_blank">00:01:48.320</a></span> | <span class="t">I'm initializing it as usual. These are all typical parameters that we'd use.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=111" target="_blank">00:01:51.840</a></span> | <span class="t">But I'm also adding in this streaming and this callbacks parameter.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=116" target="_blank">00:01:56.000</a></span> | <span class="t">Streaming is I think pretty obvious what it does.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=119" target="_blank">00:01:59.040</a></span> | <span class="t">It just switches on streaming and it's also worth noting that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=123" target="_blank">00:02:03.200</a></span> | <span class="t">this will only work with certain LLMs, not all LLMs will support streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=128" target="_blank">00:02:08.640</a></span> | <span class="t">But for OpenAI of course it is supported.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=131" target="_blank">00:02:11.760</a></span> | <span class="t">And then we also need to pass this callbacks parameter.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=134" target="_blank">00:02:14.880</a></span> | <span class="t">Okay and I think this is probably the more interesting part here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=138" target="_blank">00:02:18.880</a></span> | <span class="t">So this here is what handles the streaming, all right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=143" target="_blank">00:02:23.760</a></span> | <span class="t">This handles, you can see that it says streaming, right, okay it's streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=147" target="_blank">00:02:27.440</a></span> | <span class="t">Standard output callback handler.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=150" target="_blank">00:02:30.720</a></span> | <span class="t">So the standard output is basically like a print.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=153" target="_blank">00:02:33.360</a></span> | <span class="t">And we can even see what it's doing by heading over to its definition here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=160" target="_blank">00:02:40.320</a></span> | <span class="t">So you can come to here and we see this method on LLM new token.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=165" target="_blank">00:02:45.680</a></span> | <span class="t">When this is executed it's going to print new token, okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=171" target="_blank">00:02:51.840</a></span> | <span class="t">So that's all we're doing by adding this callback in here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=176" target="_blank">00:02:56.400</a></span> | <span class="t">With every new generated token it is going to be taken to the standard output.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=181" target="_blank">00:03:01.760</a></span> | <span class="t">Now that's great. I have initialized that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=186" target="_blank">00:03:06.000</a></span> | <span class="t">Also of course you have to put your API key here from OpenAI.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=189" target="_blank">00:03:09.440</a></span> | <span class="t">If you haven't already.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=190" target="_blank">00:03:10.720</a></span> | <span class="t">Now if we run this, okay, so like we would in LangChain normally.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=196" target="_blank">00:03:16.000</a></span> | <span class="t">So we create our human message and we just pass it to our LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=200" target="_blank">00:03:20.000</a></span> | <span class="t">You will see straight away we have streaming, right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=204" target="_blank">00:03:24.640</a></span> | <span class="t">So it took 2.2 seconds to complete.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=207" target="_blank">00:03:27.520</a></span> | <span class="t">So if we didn't enable streaming there it would have taken 2.2 seconds to show anything, right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=214" target="_blank">00:03:34.240</a></span> | <span class="t">It would have basically come out with this at the bottom here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=217" target="_blank">00:03:37.520</a></span> | <span class="t">But you saw that it kind of went through token by token printing them to our output, right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=225" target="_blank">00:03:45.520</a></span> | <span class="t">So we can see it again like that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=228" target="_blank">00:03:48.240</a></span> | <span class="t">Now this is really good especially when we have more, you know, long outputs.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=233" target="_blank">00:03:53.840</a></span> | <span class="t">So maybe we say, you know, tell me a long sorry.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=239" target="_blank">00:03:59.520</a></span> | <span class="t">And if we run it again it's going to take a little more time.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=244" target="_blank">00:04:04.480</a></span> | <span class="t">You can see, you know, we're kind of going through and obviously if we were printing</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=248" target="_blank">00:04:08.240</a></span> | <span class="t">out the whole thing nicely we'd be able to kind of follow it and read as it's going.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=253" target="_blank">00:04:13.040</a></span> | <span class="t">All right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=254" target="_blank">00:04:14.400</a></span> | <span class="t">But you can see that if we were not doing streaming here, you know, it keeps going on.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=260" target="_blank">00:04:20.560</a></span> | <span class="t">It's 19 seconds now, 20 seconds, 21 seconds.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=263" target="_blank">00:04:23.920</a></span> | <span class="t">We would be waiting that whole time just to begin reading, right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=267" target="_blank">00:04:27.760</a></span> | <span class="t">So that was almost 26 seconds in total.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=270" target="_blank">00:04:30.880</a></span> | <span class="t">If we didn't use streaming we'd have to wait that whole time to begin reading.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=274" target="_blank">00:04:34.720</a></span> | <span class="t">But with streaming we can begin reading earlier.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=278" target="_blank">00:04:38.480</a></span> | <span class="t">Which obviously is a nice little feature to have.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=282" target="_blank">00:04:42.560</a></span> | <span class="t">Now that is, you know, using an LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=286" target="_blank">00:04:46.160</a></span> | <span class="t">Using an LLM and streaming to, you know, your terminal or the Jupyter Network output is,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=293" target="_blank">00:04:53.280</a></span> | <span class="t">you know, it's the easiest thing you can do.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=296" target="_blank">00:04:56.800</a></span> | <span class="t">It begins to get a bit more complicated as soon as you start adding in more logic.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=301" target="_blank">00:05:01.760</a></span> | <span class="t">So let's take a look at how we might do it for an agent in Lightning Chain.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=307" target="_blank">00:05:07.040</a></span> | <span class="t">Okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=307" target="_blank">00:05:07.280</a></span> | <span class="t">So we're just going to initialize an agent here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=309" target="_blank">00:05:09.680</a></span> | <span class="t">We have our memory.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=310" target="_blank">00:05:10.960</a></span> | <span class="t">We are going to load in one tool.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=313" target="_blank">00:05:13.520</a></span> | <span class="t">We're going to initialize our agent.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=315" target="_blank">00:05:15.840</a></span> | <span class="t">It's going to be a conversational React agent.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=319" target="_blank">00:05:19.120</a></span> | <span class="t">Okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=320" target="_blank">00:05:20.480</a></span> | <span class="t">And we're using the same LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=321" target="_blank">00:05:21.760</a></span> | <span class="t">So because we're using the same LLM we already have our callback,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=326" target="_blank">00:05:26.720</a></span> | <span class="t">our streaming standard output callback handler that is already included within our agent.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=333" target="_blank">00:05:33.360</a></span> | <span class="t">So we can initialize that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=334" target="_blank">00:05:34.960</a></span> | <span class="t">One thing that you will or that you should do here is make sure you return intermediate steps</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=341" target="_blank">00:05:41.360</a></span> | <span class="t">as false because that will trigger issues if you're trying to call things back.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=346" target="_blank">00:05:46.880</a></span> | <span class="t">And you can actually pull back those intermediate steps by parsing what is being output to you</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=352" target="_blank">00:05:52.240</a></span> | <span class="t">anyway.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=352" target="_blank">00:05:52.960</a></span> | <span class="t">And I also set verbose equal to true so that we can actually get all of the outputs.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=359" target="_blank">00:05:59.440</a></span> | <span class="t">So after initializing that, I'm going to go to, I'm going to create this prompt.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=363" target="_blank">00:06:03.120</a></span> | <span class="t">It's just a string this time rather than the messages.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=366" target="_blank">00:06:06.000</a></span> | <span class="t">That's just because we're using an agent rather than the LLM directly.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=370" target="_blank">00:06:10.080</a></span> | <span class="t">And yeah, let's try.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=373" target="_blank">00:06:13.440</a></span> | <span class="t">Okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=376" target="_blank">00:06:16.560</a></span> | <span class="t">And you see that it actually, you know, it's streamed and it output the entire, you know,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=381" target="_blank">00:06:21.600</a></span> | <span class="t">we have the action, the action input.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=383" target="_blank">00:06:23.680</a></span> | <span class="t">So whereas before we kind of just had this bit with a agent, we have more because an</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=391" target="_blank">00:06:31.600</a></span> | <span class="t">agent basically works.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=392" target="_blank">00:06:32.720</a></span> | <span class="t">It's like an added little bit of logic around the LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=397" target="_blank">00:06:37.120</a></span> | <span class="t">And in order for it to correctly parse the, what the LLM wants to do, it asks it to return</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=404" target="_blank">00:06:44.320</a></span> | <span class="t">the output from the LLM in this JSON format with an action and an action input.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=410" target="_blank">00:06:50.160</a></span> | <span class="t">Now, this is useful because, you know, sometimes maybe we want to use a tool using our agent,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=418" target="_blank">00:06:58.640</a></span> | <span class="t">or we want to go through multiple, almost like thinking steps, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=423" target="_blank">00:07:03.440</a></span> | <span class="t">So here's an example of that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=424" target="_blank">00:07:04.640</a></span> | <span class="t">We're going to use the calculator tool or the LLM math tool that we created.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=429" target="_blank">00:07:09.200</a></span> | <span class="t">So we're going to say, what is the square root of 71?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=431" target="_blank">00:07:11.920</a></span> | <span class="t">We run this and you see it's using the calculator action, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=436" target="_blank">00:07:16.480</a></span> | <span class="t">And from that, it basically uses this calculator tool and it puts in this value here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=444" target="_blank">00:07:24.000</a></span> | <span class="t">So the square root of 71.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=445" target="_blank">00:07:25.760</a></span> | <span class="t">And from that, it gets this answer, which it can then feed back to us in the final answer.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=451" target="_blank">00:07:31.200</a></span> | <span class="t">Right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=451" target="_blank">00:07:31.520</a></span> | <span class="t">And when we ran that, it's going to stream the, you know, the calculator.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=457" target="_blank">00:07:37.920</a></span> | <span class="t">It also streams this little bit here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=460" target="_blank">00:07:40.720</a></span> | <span class="t">I'm actually not sure why it does this, but anyway, and then it streams the final answer.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=466" target="_blank">00:07:46.560</a></span> | <span class="t">OK, so we can pass that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=468" target="_blank">00:07:48.560</a></span> | <span class="t">We can extract the tools.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=470" target="_blank">00:07:50.240</a></span> | <span class="t">We can extract the final answer and just do it in a cleaner way.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=474" target="_blank">00:07:54.160</a></span> | <span class="t">But how do we do that in a cleaner way, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=477" target="_blank">00:07:57.760</a></span> | <span class="t">Because right now it's just outputting everything to us.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=480" target="_blank">00:08:00.320</a></span> | <span class="t">Well, we have like two options.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=483" target="_blank">00:08:03.280</a></span> | <span class="t">We can either use, there's a lang chain callback handler built specifically for outputting the</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=492" target="_blank">00:08:12.320</a></span> | <span class="t">final answer to us from an agent.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=496" target="_blank">00:08:16.240</a></span> | <span class="t">That is literally what it's for.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=497" target="_blank">00:08:17.680</a></span> | <span class="t">And the other option is we can create a custom callback handler.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=502" target="_blank">00:08:22.560</a></span> | <span class="t">And I would say the custom callback handler is, well, it's more flexible, of course.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=507" target="_blank">00:08:27.840</a></span> | <span class="t">It just means it requires a little bit more extra work on our side.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=511" target="_blank">00:08:31.840</a></span> | <span class="t">But both are pretty straightforward.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=514" target="_blank">00:08:34.480</a></span> | <span class="t">So let's first have a look at the simple out-of-the-box lang chain callback handler.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=521" target="_blank">00:08:41.120</a></span> | <span class="t">OK, so because we're initializing a new callback handler, we need to reinitialize our LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=526" target="_blank">00:08:46.400</a></span> | <span class="t">For now, I'm going to use the default tokens here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=530" target="_blank">00:08:50.960</a></span> | <span class="t">So I will initialize it like that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=533" target="_blank">00:08:53.440</a></span> | <span class="t">And we also reinitialize the agent.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=535" target="_blank">00:08:55.520</a></span> | <span class="t">And then we can go ahead and try and see what we get.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=541" target="_blank">00:09:01.520</a></span> | <span class="t">OK.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=541" target="_blank">00:09:01.520</a></span> | <span class="t">Right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=546" target="_blank">00:09:06.880</a></span> | <span class="t">So it didn't really, it didn't stream anything.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=551" target="_blank">00:09:11.680</a></span> | <span class="t">It just streamed this little bit here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=554" target="_blank">00:09:14.640</a></span> | <span class="t">And that's because by default, this is looking, it's looking for something like, well, something</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=563" target="_blank">00:09:23.040</a></span> | <span class="t">wrong.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=563" target="_blank">00:09:23.280</a></span> | <span class="t">So rather than looking for final answer, it's looking for something like, I don't know,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=568" target="_blank">00:09:28.080</a></span> | <span class="t">final answer with a lowercase a or something along those lines.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=571" target="_blank">00:09:31.600</a></span> | <span class="t">I don't quite remember.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=572" target="_blank">00:09:32.880</a></span> | <span class="t">So what we can do instead is obviously just say with this answer prefix tokens, once you</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=579" target="_blank">00:09:39.120</a></span> | <span class="t">see these tokens, then you begin streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=582" target="_blank">00:09:42.400</a></span> | <span class="t">Right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=582" target="_blank">00:09:42.960</a></span> | <span class="t">So we should hopefully get a better result by doing this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=586" target="_blank">00:09:46.320</a></span> | <span class="t">Let's try.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=587" target="_blank">00:09:47.520</a></span> | <span class="t">OK.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=594" target="_blank">00:09:54.240</a></span> | <span class="t">OK.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=596" target="_blank">00:09:56.160</a></span> | <span class="t">So it started streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=597" target="_blank">00:09:57.840</a></span> | <span class="t">It streamed.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=598" target="_blank">00:09:58.560</a></span> | <span class="t">But then again, it's still kind of messy.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=601" target="_blank">00:10:01.200</a></span> | <span class="t">So honestly, the easier approach, in my opinion, is just to use a custom callback handler.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=609" target="_blank">00:10:09.280</a></span> | <span class="t">So to do that, we come down to here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=612" target="_blank">00:10:12.640</a></span> | <span class="t">OK.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=614" target="_blank">00:10:14.080</a></span> | <span class="t">And I just create this here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=616" target="_blank">00:10:16.320</a></span> | <span class="t">So this is the custom callback handler.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=618" target="_blank">00:10:18.000</a></span> | <span class="t">Let me go through it step by step.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=621" target="_blank">00:10:21.360</a></span> | <span class="t">So first, let's just remove that first.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=625" target="_blank">00:10:25.520</a></span> | <span class="t">OK, we're inheriting the class from the streaming standard output callback handler that we saw</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=632" target="_blank">00:10:32.240</a></span> | <span class="t">before.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=633" target="_blank">00:10:33.040</a></span> | <span class="t">We initialize it and we set this self content variable equal to just an empty string.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=639" target="_blank">00:10:39.120</a></span> | <span class="t">Basically, we're going to be feeding everything into that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=641" target="_blank">00:10:41.680</a></span> | <span class="t">And we're going to be using that as a almost like a check.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=645" target="_blank">00:10:45.040</a></span> | <span class="t">When we see that the final answer is within this self content, we're going to switch to</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=649" target="_blank">00:10:49.760</a></span> | <span class="t">actually streaming rather than just doing nothing.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=653" target="_blank">00:10:53.360</a></span> | <span class="t">And the way that we make that switch is using this final answer value.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=658" target="_blank">00:10:58.720</a></span> | <span class="t">OK, so let's add the rest of that in there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=662" target="_blank">00:11:02.640</a></span> | <span class="t">So this is the onLLM new token.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=665" target="_blank">00:11:05.840</a></span> | <span class="t">We saw this earlier in the line chain definition for actually this class here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=672" target="_blank">00:11:12.720</a></span> | <span class="t">So we're creating our own version of this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=674" target="_blank">00:11:14.960</a></span> | <span class="t">Now, this is called with every new token output by the LLM.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=680" target="_blank">00:11:20.080</a></span> | <span class="t">So we take that token, we add it to our entire content, and then we say, OK, if the final</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=688" target="_blank">00:11:28.560</a></span> | <span class="t">answer is in self content, that means we're now in the final answer section.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=693" target="_blank">00:11:33.840</a></span> | <span class="t">So we set final answer equal to true.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=695" target="_blank">00:11:35.680</a></span> | <span class="t">But then we also reinitialize our content, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=701" target="_blank">00:11:41.040</a></span> | <span class="t">And maybe I can just show you why we do that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=704" target="_blank">00:11:44.320</a></span> | <span class="t">So I'll comment that out.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=705" target="_blank">00:11:45.840</a></span> | <span class="t">We say, OK, if the final answer is true, that means this will activate.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=710" target="_blank">00:11:50.640</a></span> | <span class="t">And this is where we actually get where we actually output our token.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=714" target="_blank">00:11:54.640</a></span> | <span class="t">So again, like I said, this is just equal to printing the token.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=717" target="_blank">00:11:57.600</a></span> | <span class="t">So once we get that final answer, we still need to wait for action input.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=723" target="_blank">00:12:03.600</a></span> | <span class="t">And then once we see that, we begin printing.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=726" target="_blank">00:12:06.880</a></span> | <span class="t">So let's run all of that and let's try.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=734" target="_blank">00:12:14.080</a></span> | <span class="t">OK, and if you saw just that, it began printing action input as soon as it saw final answer.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=741" target="_blank">00:12:21.280</a></span> | <span class="t">In fact, it even gets answer here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=743" target="_blank">00:12:23.440</a></span> | <span class="t">Now, the reason it does that is because as soon as we see final answer, that gets activated.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=748" target="_blank">00:12:28.640</a></span> | <span class="t">But action input is already there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=750" target="_blank">00:12:30.160</a></span> | <span class="t">So it's actually looking for this one and saying, OK, now we can start printing stuff.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=754" target="_blank">00:12:34.000</a></span> | <span class="t">It doesn't wait for the second action input.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=756" target="_blank">00:12:36.560</a></span> | <span class="t">So that's why we add or that's why we reinitialize the content here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=763" target="_blank">00:12:43.040</a></span> | <span class="t">So try it with that and see if it works any better.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=766" target="_blank">00:12:46.400</a></span> | <span class="t">OK, so you see that it began the streaming on the actual answer output or answer input.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=779" target="_blank">00:12:59.600</a></span> | <span class="t">Sorry.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=780" target="_blank">00:13:00.080</a></span> | <span class="t">Now, there is one thing that I haven't been able to figure out.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=782" target="_blank">00:13:02.720</a></span> | <span class="t">And, you know, if anyone out there knows how to deal with this, please let me know.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=788" target="_blank">00:13:08.640</a></span> | <span class="t">But this little bit here is so streamed, which doesn't make much sense to me.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=794" target="_blank">00:13:14.400</a></span> | <span class="t">I was looking at this, trying to figure out where it is being streamed from.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=798" target="_blank">00:13:18.400</a></span> | <span class="t">But honestly, I have no idea.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=802" target="_blank">00:13:22.000</a></span> | <span class="t">But anyway, I thought, OK, I'm not really too bothered about that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=806" target="_blank">00:13:26.960</a></span> | <span class="t">It's streaming this out here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=808" target="_blank">00:13:28.960</a></span> | <span class="t">I can add some sort of filter or whatever around the backticks.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=811" target="_blank">00:13:31.840</a></span> | <span class="t">But rather than dealing with that, what is more important to me</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=815" target="_blank">00:13:35.920</a></span> | <span class="t">is getting all this working with an API, which, again,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=819" target="_blank">00:13:39.280</a></span> | <span class="t">adds a little more complexity to the whole thing.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=822" target="_blank">00:13:42.800</a></span> | <span class="t">The issue with getting this working with API is primarily that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=828" target="_blank">00:13:48.080</a></span> | <span class="t">in order to pass these tokens through an API, like if you're using FastAPI, for example,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=834" target="_blank">00:13:54.080</a></span> | <span class="t">you need to be running a loop that is looking your tokens and passing it through</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=840" target="_blank">00:14:00.800</a></span> | <span class="t">what is called a streaming response object.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=843" target="_blank">00:14:03.360</a></span> | <span class="t">The only issue is that we also, at the same time, need to be running our agent logic.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=848" target="_blank">00:14:08.080</a></span> | <span class="t">So we need to be running these two separate bits of code at the same time.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=851" target="_blank">00:14:11.680</a></span> | <span class="t">Essentially, we're going to have to rely on a lot of async functions.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=856" target="_blank">00:14:16.320</a></span> | <span class="t">So the first thing we need to do is set up our API.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=859" target="_blank">00:14:19.280</a></span> | <span class="t">So I've started this very simple version.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=862" target="_blank">00:14:22.000</a></span> | <span class="t">It doesn't include streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=863" target="_blank">00:14:23.360</a></span> | <span class="t">It's just a FastAPI.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=864" target="_blank">00:14:24.640</a></span> | <span class="t">It includes everything in this notebook, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=867" target="_blank">00:14:27.280</a></span> | <span class="t">So in here, we're actually just initializing our agent.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=872" target="_blank">00:14:32.880</a></span> | <span class="t">And then we go on.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=873" target="_blank">00:14:33.600</a></span> | <span class="t">We have this, like, the input format that we query with or that we send to our API.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=879" target="_blank">00:14:39.920</a></span> | <span class="t">We have a health check here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=882" target="_blank">00:14:42.320</a></span> | <span class="t">We're going to test that in a moment.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=883" target="_blank">00:14:43.680</a></span> | <span class="t">And then we also have this chat endpoint.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=886" target="_blank">00:14:46.800</a></span> | <span class="t">Okay, so that's where we're going to be sending our queries to there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=890" target="_blank">00:14:50.000</a></span> | <span class="t">This is just some FastAPI stuff to get everything running.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=893" target="_blank">00:14:53.520</a></span> | <span class="t">So before we run anything, we need to actually start the API.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=898" target="_blank">00:14:58.640</a></span> | <span class="t">So we switch over to our terminal.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=902" target="_blank">00:15:02.080</a></span> | <span class="t">I'm going to check where we are.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=903" target="_blank">00:15:03.280</a></span> | <span class="t">So we have this demo.py file here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=906" target="_blank">00:15:06.240</a></span> | <span class="t">That is the API I'm running.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=908" target="_blank">00:15:08.400</a></span> | <span class="t">So I'm going to do evicorn demo app reload.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=913" target="_blank">00:15:13.840</a></span> | <span class="t">Okay, if you're going to run this with what will be the main Python file I'm going to show you,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=922" target="_blank">00:15:22.480</a></span> | <span class="t">you would just replace demo with main there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=925" target="_blank">00:15:25.760</a></span> | <span class="t">Okay, so we can check that it's running by calling this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=930" target="_blank">00:15:30.000</a></span> | <span class="t">Okay, we should get this status here that, okay, everything's good.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=933" target="_blank">00:15:33.600</a></span> | <span class="t">Now, this here is actually how we would do streaming, but we haven't implemented streaming yet.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=939" target="_blank">00:15:39.360</a></span> | <span class="t">So let's just send a request, like we usually would, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=943" target="_blank">00:15:43.760</a></span> | <span class="t">So what I will first do actually will just be to get rather than post.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=951" target="_blank">00:15:51.440</a></span> | <span class="t">And I'm going to do request.get and send it to that endpoint.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=958" target="_blank">00:15:58.160</a></span> | <span class="t">So localhost 2000, and it is a chat endpoint.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=965" target="_blank">00:16:05.200</a></span> | <span class="t">And now we have something that we actually want to send, which is a JSON.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=971" target="_blank">00:16:11.520</a></span> | <span class="t">And in there, we have a text parameter, and we'll just put our query.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=976" target="_blank">00:16:16.240</a></span> | <span class="t">So let's put hello there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=977" target="_blank">00:16:17.600</a></span> | <span class="t">Okay, let's run that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=988" target="_blank">00:16:28.000</a></span> | <span class="t">See what we get.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=988" target="_blank">00:16:28.640</a></span> | <span class="t">Okay, 200, that's good.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=993" target="_blank">00:16:33.360</a></span> | <span class="t">And let's see what that contains.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=995" target="_blank">00:16:35.280</a></span> | <span class="t">Okay, so we got the response here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=997" target="_blank">00:16:37.840</a></span> | <span class="t">That's great, but that obviously, that's not streaming, we want to implement streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1002" target="_blank">00:16:42.800</a></span> | <span class="t">So let's go through how we would do that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1006" target="_blank">00:16:46.560</a></span> | <span class="t">So the first thing we're going to want to do is,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1009" target="_blank">00:16:49.200</a></span> | <span class="t">we're going to need to add the callback to our agent, but we've already initialized it.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1013" target="_blank">00:16:53.600</a></span> | <span class="t">So we're just going to replace the parameters in there, or the callback parameter in there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1019" target="_blank">00:16:59.440</a></span> | <span class="t">So we'll do async def run call.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1026" target="_blank">00:17:06.320</a></span> | <span class="t">And we'll have a query, but we'll also have a streaming iterator in here as well.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1033" target="_blank">00:17:13.840</a></span> | <span class="t">Now the streaming iterator will be of the type, initially, it will be of this type.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1040" target="_blank">00:17:20.560</a></span> | <span class="t">Okay, so the async iterator callback handler.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1043" target="_blank">00:17:23.520</a></span> | <span class="t">So let's put that there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1047" target="_blank">00:17:27.360</a></span> | <span class="t">And the first thing we want to do is assign that stream iterator to our callbacks like this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1053" target="_blank">00:17:33.600</a></span> | <span class="t">Okay, and then from there, what we want to do is await our agent call.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1059" target="_blank">00:17:39.040</a></span> | <span class="t">But because we're doing everything in async, we actually need to call a call like this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1065" target="_blank">00:17:45.280</a></span> | <span class="t">And in that, we're going to pass out inputs, which is going to be our input,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1071" target="_blank">00:17:51.040</a></span> | <span class="t">which maps to our query like this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1075" target="_blank">00:17:55.600</a></span> | <span class="t">Okay, so that will get us, you know, we're going to get our response.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1080" target="_blank">00:18:00.800</a></span> | <span class="t">And let me show you what you can do with that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1083" target="_blank">00:18:03.680</a></span> | <span class="t">So we'll get a response.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1085" target="_blank">00:18:05.280</a></span> | <span class="t">Let's say we return that response.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1089" target="_blank">00:18:09.200</a></span> | <span class="t">And what we'll do here is we will actually just call this run call here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1097" target="_blank">00:18:17.760</a></span> | <span class="t">So we're going to do response, await, run call.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1101" target="_blank">00:18:21.200</a></span> | <span class="t">Okay, exactly, not quite like that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1107" target="_blank">00:18:27.120</a></span> | <span class="t">So we need this in here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1108" target="_blank">00:18:28.640</a></span> | <span class="t">Okay, or we can even separate that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1112" target="_blank">00:18:32.720</a></span> | <span class="t">So we can create our streaming iterator here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1117" target="_blank">00:18:37.200</a></span> | <span class="t">So now we just pass it into here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1121" target="_blank">00:18:41.520</a></span> | <span class="t">Okay, cool.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1124" target="_blank">00:18:44.000</a></span> | <span class="t">So we can, we'll save that, that's going to reload.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1126" target="_blank">00:18:46.880</a></span> | <span class="t">And then we can just see if it's working.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1132" target="_blank">00:18:52.000</a></span> | <span class="t">Let's try.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1132" target="_blank">00:18:52.560</a></span> | <span class="t">So, okay, health first, all is good.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1136" target="_blank">00:18:56.560</a></span> | <span class="t">Let's try this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1137" target="_blank">00:18:57.360</a></span> | <span class="t">Okay, right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1141" target="_blank">00:19:01.200</a></span> | <span class="t">So, so far, it just seemed to, you know, give us a response straight away.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1145" target="_blank">00:19:05.760</a></span> | <span class="t">But at the same time, we're not doing a streaming request here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1149" target="_blank">00:19:09.040</a></span> | <span class="t">So actually, we should try this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1151" target="_blank">00:19:11.920</a></span> | <span class="t">So let's try it, get stream.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1153" target="_blank">00:19:13.760</a></span> | <span class="t">Okay, method not allowed.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1156" target="_blank">00:19:16.480</a></span> | <span class="t">That's what I get, post, sorry.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1158" target="_blank">00:19:18.720</a></span> | <span class="t">So let's change that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1160" target="_blank">00:19:20.320</a></span> | <span class="t">Okay, it's taking a long time.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1164" target="_blank">00:19:24.800</a></span> | <span class="t">And that's because this isn't a stream.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1168" target="_blank">00:19:28.240</a></span> | <span class="t">It's kind of just like stuck now.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1170" target="_blank">00:19:30.640</a></span> | <span class="t">All right, so if we look over here, we can see it's entering the new execute chain.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1173" target="_blank">00:19:33.920</a></span> | <span class="t">It has generated us a story, not without any errors though.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1179" target="_blank">00:19:39.680</a></span> | <span class="t">And okay, we have something there, but we just got an internal server error.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1184" target="_blank">00:19:44.960</a></span> | <span class="t">So clearly that whatever we just did doesn't work.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1188" target="_blank">00:19:48.160</a></span> | <span class="t">Let's change that to high there, so it's a little quicker.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1191" target="_blank">00:19:51.360</a></span> | <span class="t">Now, if we try and make another get request, we'll also see that error again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1199" target="_blank">00:19:59.840</a></span> | <span class="t">So basically we broke it and we just need to, we're going to shut it down and restart.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1208" target="_blank">00:20:08.720</a></span> | <span class="t">Okay, now let's try again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1210" target="_blank">00:20:10.320</a></span> | <span class="t">Okay, now it looks good.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1214" target="_blank">00:20:14.160</a></span> | <span class="t">So we're clearly missing a few things from our file here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1217" target="_blank">00:20:17.680</a></span> | <span class="t">So let's work through those.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1219" target="_blank">00:20:19.680</a></span> | <span class="t">Now, in order to get streaming working, we can't just return a response like this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1224" target="_blank">00:20:24.720</a></span> | <span class="t">We actually need to return what is called a streaming response here, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1229" target="_blank">00:20:29.440</a></span> | <span class="t">We have this value here I'll talk about in a moment.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1231" target="_blank">00:20:31.920</a></span> | <span class="t">So we're returning this event stream, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1235" target="_blank">00:20:35.760</a></span> | <span class="t">So I need to go up to the top, I'm going to uncomment that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1238" target="_blank">00:20:38.880</a></span> | <span class="t">And now we have our streaming response, but our streaming response expects a generator, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1246" target="_blank">00:20:46.720</a></span> | <span class="t">So, okay, maybe we can just put response in there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1249" target="_blank">00:20:49.840</a></span> | <span class="t">Let's see what happens.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1250" target="_blank">00:20:50.880</a></span> | <span class="t">Okay, let's come to here and try again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1254" target="_blank">00:20:54.480</a></span> | <span class="t">Okay, and we get this error.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1259" target="_blank">00:20:59.840</a></span> | <span class="t">If we look at our terminal here, we see that we have this dict object is not an iterator.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1264" target="_blank">00:21:04.960</a></span> | <span class="t">That is because our streaming response here expects a generator object</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1270" target="_blank">00:21:10.160</a></span> | <span class="t">or something it can iterate over.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1271" target="_blank">00:21:11.760</a></span> | <span class="t">And we don't have that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1273" target="_blank">00:21:13.200</a></span> | <span class="t">We're just kind of returning everything at the moment.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1275" target="_blank">00:21:15.280</a></span> | <span class="t">So we need to fix that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1277" target="_blank">00:21:17.200</a></span> | <span class="t">And the way that we fix that is actually by not giving it the response,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1283" target="_blank">00:21:23.040</a></span> | <span class="t">but by actually giving it our iterator here, because this is an iterator, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1288" target="_blank">00:21:28.160</a></span> | <span class="t">But we need more of like a standard generator.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1291" target="_blank">00:21:31.520</a></span> | <span class="t">So we come to, let's come to here, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1295" target="_blank">00:21:35.520</a></span> | <span class="t">We have this create generator.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1297" target="_blank">00:21:37.760</a></span> | <span class="t">It's going to be taking, for now, let's take this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1302" target="_blank">00:21:42.160</a></span> | <span class="t">We use async I/O, so I need to import that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1307" target="_blank">00:21:47.920</a></span> | <span class="t">So we have async I/O create task.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1312" target="_blank">00:21:52.080</a></span> | <span class="t">And we are using this, we're sending our run call to execute in the background.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1320" target="_blank">00:22:00.240</a></span> | <span class="t">Concurrently alongside our other tasks are also running, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1324" target="_blank">00:22:04.080</a></span> | <span class="t">Because we also need to be running this here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1326" target="_blank">00:22:06.640</a></span> | <span class="t">So by using this create task, we allow this to be run in the background</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1332" target="_blank">00:22:12.960</a></span> | <span class="t">whilst we're also running this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1334" target="_blank">00:22:14.800</a></span> | <span class="t">Now, this here, the reason that it needs to be running is because this is how</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1340" target="_blank">00:22:20.720</a></span> | <span class="t">we get tokens from here and send them into our stream response here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1350" target="_blank">00:22:30.560</a></span> | <span class="t">All right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1350" target="_blank">00:22:30.880</a></span> | <span class="t">So to actually set that up, we need to get our generator.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1355" target="_blank">00:22:35.920</a></span> | <span class="t">We can actually drop the response object here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1358" target="_blank">00:22:38.960</a></span> | <span class="t">We don't need it.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1359" target="_blank">00:22:39.600</a></span> | <span class="t">And we replace this with our generator.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1362" target="_blank">00:22:42.560</a></span> | <span class="t">Okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1363" target="_blank">00:22:43.040</a></span> | <span class="t">And obviously now we don't actually need to have this run call here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1367" target="_blank">00:22:47.520</a></span> | <span class="t">So save that and let's try and run again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1371" target="_blank">00:22:51.280</a></span> | <span class="t">Okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1373" target="_blank">00:22:53.040</a></span> | <span class="t">Nice.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1376" target="_blank">00:22:56.480</a></span> | <span class="t">So that kind of looks like it's streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1379" target="_blank">00:22:59.760</a></span> | <span class="t">But let's rerun that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1382" target="_blank">00:23:02.480</a></span> | <span class="t">And we'll look at the terminal as well and see at what point is this actually running?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1387" target="_blank">00:23:07.360</a></span> | <span class="t">Because sometimes it can kind of trick you and you might think that you're running this</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1393" target="_blank">00:23:13.200</a></span> | <span class="t">or you're streaming this, but actually it's loaded everything.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1396" target="_blank">00:23:16.640</a></span> | <span class="t">And then it begins streaming, which is not ideal.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1399" target="_blank">00:23:19.520</a></span> | <span class="t">So what we're looking for here is that this will begin streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1405" target="_blank">00:23:25.760</a></span> | <span class="t">In fact, we can ask for the long story now.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1407" target="_blank">00:23:27.760</a></span> | <span class="t">So tell me a long story.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1410" target="_blank">00:23:30.080</a></span> | <span class="t">This should begin streaming whilst it's still only on entering new executor chain.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1417" target="_blank">00:23:37.120</a></span> | <span class="t">All right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1417" target="_blank">00:23:37.440</a></span> | <span class="t">If it comes up with this before we start streaming, it means that we're not actually streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1421" target="_blank">00:23:41.840</a></span> | <span class="t">So let's try.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1423" target="_blank">00:23:43.520</a></span> | <span class="t">Okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1428" target="_blank">00:23:48.160</a></span> | <span class="t">Looks good.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1428" target="_blank">00:23:48.640</a></span> | <span class="t">We're streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1430" target="_blank">00:23:50.160</a></span> | <span class="t">It hasn't come up with the answer yet.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1431" target="_blank">00:23:51.920</a></span> | <span class="t">So that means it's actually giving us these tokens as they are being generated by the model.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1438" target="_blank">00:23:58.160</a></span> | <span class="t">But then we get to the end here and we still have this error.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1441" target="_blank">00:24:01.600</a></span> | <span class="t">So we need to stop our app on the other side and we will just run that again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1447" target="_blank">00:24:07.360</a></span> | <span class="t">Let's try again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1449" target="_blank">00:24:09.920</a></span> | <span class="t">All right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1450" target="_blank">00:24:10.160</a></span> | <span class="t">So tell me a long story or let's go high there again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1453" target="_blank">00:24:13.120</a></span> | <span class="t">Just make it quick.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1453" target="_blank">00:24:13.920</a></span> | <span class="t">Okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1459" target="_blank">00:24:19.920</a></span> | <span class="t">So we can see here that it should do this all the time.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1463" target="_blank">00:24:23.840</a></span> | <span class="t">But it's returning like the full response, like the agent formatted response.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1467" target="_blank">00:24:27.920</a></span> | <span class="t">And we don't necessarily want that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1469" target="_blank">00:24:29.120</a></span> | <span class="t">We kind of want it to just return this bit here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1472" target="_blank">00:24:32.400</a></span> | <span class="t">So to do that, we need to go into sort of custom callback handlers again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1477" target="_blank">00:24:37.760</a></span> | <span class="t">So we can modify that as we saw before.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1482" target="_blank">00:24:42.080</a></span> | <span class="t">We had like a custom callbacks.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1483" target="_blank">00:24:43.920</a></span> | <span class="t">We can do the same here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1485" target="_blank">00:24:45.440</a></span> | <span class="t">So I'm just going to copy the custom callback code in and I'll just go through it with you.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1491" target="_blank">00:24:51.520</a></span> | <span class="t">So we need LLM result and we also need any here as well.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1496" target="_blank">00:24:56.000</a></span> | <span class="t">So I'm taking the async iterated callback handler.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1500" target="_blank">00:25:00.240</a></span> | <span class="t">And that has these two methods that we need to override.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1504" target="_blank">00:25:04.560</a></span> | <span class="t">So on LLM new token, basically here, because we're using agents,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1508" target="_blank">00:25:08.800</a></span> | <span class="t">I want to do what we did before.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1510" target="_blank">00:25:10.400</a></span> | <span class="t">We're checking for the final answer and also the action input.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1513" target="_blank">00:25:13.680</a></span> | <span class="t">But slightly differently, on LLM end, one, I want to check, okay,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1520" target="_blank">00:25:20.240</a></span> | <span class="t">have we reached final answer yet?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1522" target="_blank">00:25:22.000</a></span> | <span class="t">Because if we're using multiple tools, it will basically say I'm done as soon as it</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1527" target="_blank">00:25:27.280</a></span> | <span class="t">hits the first tool, which we don't want.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1529" target="_blank">00:25:29.680</a></span> | <span class="t">So by adding that sort of if statement in there, we are stopping streaming,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1536" target="_blank">00:25:36.400</a></span> | <span class="t">but only once the final answer has been given.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1539" target="_blank">00:25:39.200</a></span> | <span class="t">And we have this.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1540" target="_blank">00:25:40.480</a></span> | <span class="t">So self done set.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1542" target="_blank">00:25:42.240</a></span> | <span class="t">All right.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1542" target="_blank">00:25:42.480</a></span> | <span class="t">So this tells the callback handler when the callback is or when streaming is complete.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1548" target="_blank">00:25:48.160</a></span> | <span class="t">And once that is complete, we come down to here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1553" target="_blank">00:25:53.600</a></span> | <span class="t">So we have this await task.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1554" target="_blank">00:25:54.880</a></span> | <span class="t">This is going to finish, right?</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1557" target="_blank">00:25:57.040</a></span> | <span class="t">Now we need to replace this with our async callback handler.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1562" target="_blank">00:26:02.400</a></span> | <span class="t">So the name we gave it here.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1564" target="_blank">00:26:04.560</a></span> | <span class="t">And we should also change the types here as well.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1572" target="_blank">00:26:12.960</a></span> | <span class="t">Okay, cool.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1574" target="_blank">00:26:14.720</a></span> | <span class="t">So we rerun that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1575" target="_blank">00:26:15.920</a></span> | <span class="t">Now we can try again.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1577" target="_blank">00:26:17.440</a></span> | <span class="t">Okay.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1581" target="_blank">00:26:21.200</a></span> | <span class="t">And now you can see we just get that, like not the full agent output there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1586" target="_blank">00:26:26.000</a></span> | <span class="t">So with that, we have our pretty rough API that can handle streaming.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1592" target="_blank">00:26:32.880</a></span> | <span class="t">Obviously, there's a few other things we should really add in most cases.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1597" target="_blank">00:26:37.600</a></span> | <span class="t">We should obviously test it a lot more and just see if there's any weird things that</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1601" target="_blank">00:26:41.760</a></span> | <span class="t">happen, particularly in the way that we have the callback handler set up right now is,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1606" target="_blank">00:26:46.480</a></span> | <span class="t">you know, we're looking specifically for the final answer in the content.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1610" target="_blank">00:26:50.160</a></span> | <span class="t">What if the agent just decides that it's not going to generate the final answer or,</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1616" target="_blank">00:26:56.240</a></span> | <span class="t">you know, the agent format that it should do, you know, we need to have some logic in</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1621" target="_blank">00:27:01.200</a></span> | <span class="t">there just to handle those cases where it might do that.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1625" target="_blank">00:27:05.840</a></span> | <span class="t">But for the most part, this is like the core of what you need in order to actually</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1631" target="_blank">00:27:11.680</a></span> | <span class="t">have streaming and have it behind an API.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1634" target="_blank">00:27:14.080</a></span> | <span class="t">Now, that's it for this video.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1636" target="_blank">00:27:16.800</a></span> | <span class="t">So I hope this has been useful and interesting.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1640" target="_blank">00:27:20.320</a></span> | <span class="t">But for now, I will leave it there.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1641" target="_blank">00:27:21.680</a></span> | <span class="t">So thank you very much for watching and I will see you again in the next one.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1645" target="_blank">00:27:25.040</a></span> | <span class="t">Bye.</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1645" target="_blank">00:27:25.920</a></span> | <span class="t">[MUSIC]</span></div><div class="c"><span class="s"><a href="https://www.youtube.com/watch?v=y2cRcOPHL_U&t=1659" target="_blank">00:27:39.920</a></span> | <span class="t">[BLANK_AUDIO]</span></div></div></body></html>